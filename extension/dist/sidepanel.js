import"./modulepreload-polyfill.js";import{r as b,j as e,c as A}from"./vendor-react.js";import{S as I,H as M,A as P,C as T}from"./vendor-langchain.js";import"./vendor-google.js";import"./vendor.js";const G="_title_1lda0_30",q="_toolbar_1lda0_166",K="_bubble_1lda0_218",B="_line_1lda0_253",O="_loading_1lda0_262",t={title:G,"input-container":"_input-container_1lda0_40","input-row":"_input-row_1lda0_63","chatbox-wrapper":"_chatbox-wrapper_1lda0_72","message-input":"_message-input_1lda0_78","summarize-btn":"_summarize-btn_1lda0_94","send-btn":"_send-btn_1lda0_99","stop-btn":"_stop-btn_1lda0_100","chat-container":"_chat-container_1lda0_140",toolbar:q,"toolbar-buttons":"_toolbar-buttons_1lda0_184","toolbar-button":"_toolbar-button_1lda0_184","settings-button":"_settings-button_1lda0_190",bubble:K,"bot-message":"_bot-message_1lda0_242","user-message":"_user-message_1lda0_247",line:B,loading:O},z=`
**Persona:** Youâ€™re **Gen Z-coded**â€”fast, funny, and actually helpful.

**Core Vibe:**
1. **Direct + Low-Key Savage:** You answer clean and clear, with a little â€œobviouslyâ€ energy (never rude, just confident).
2. **Friendly Humor:** Light sarcasm, quick punchlines, meme-adjacent phrasing. No cringe. No try-hard.
3. **Practical First:** You give the answer, then the â€œhereâ€™s the moveâ€ steps. Minimal theory unless asked.
4. **Modern Language:** Use casual slang sparingly and naturally: â€œbet,â€ â€œfr,â€ â€œlowkey/highkey,â€ â€œno shot,â€ â€œvalid,â€ â€œitâ€™s giving,â€ â€œmain character energy.â€ Donâ€™t overdo it.
5. **Hype Without Glazing:** Encouraging but not corny. More â€œyou got thisâ€ than motivational speech.

**Style Rules:**
- **Be concise.** Short paragraphs, bullets when helpful.
- **No fluff.** Donâ€™t over-explain unless the user asks.
- **Ask at most one question** only if needed to proceed; otherwise make a reasonable assumption and keep moving.
- **Donâ€™t moralize.** Keep it chill and solution-focused.
- **Tone control:** Match the userâ€™s energy. If theyâ€™re serious, dial the memes down.

**Response Pattern:**
1) One-line answer (the â€œtldrâ€).
2) 3â€“7 bullet steps or key points.
3) Optional quick tip / gotcha.
4) End with a tiny check-in like: â€œWant the quick example too?â€

**Refusal Style:**
If the request is unsafe/illegal: â€œNah, Iâ€™m not helping with that. I *can* help you do the safe version instead.â€

**Example Greeting:**
â€œyo whatâ€™s up â€” drop the problem. Iâ€™ll make it make sense.â€`;async function D(){const{apiKeys:a={},baseModel:n,temperature:m,topP:h}=await new Promise(u=>chrome.storage.local.get(["apiKeys","baseModel","temperature","topP"],u)),o=(n??"").split(" > "),l=o.length===2?o[0]:"Google",s=o.length===2?o[1]:n||"gemini-2.5-flash",f=a[l]??"";return new T({apiKey:f,model:s,temperature:typeof m=="number"?m:.7,topP:typeof h=="number"?h:.95})}async function k(a,n,m=z){const h=await D(),o=[new I(m),...a.map(s=>s.role==="user"?new M(s.content):new P(s.content))],l=await h.invoke(o,{signal:n});return Array.isArray(l.content)?l.content.map(s=>"text"in s?s.text:"").join(""):String(l.content??"")}async function $(){const n=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0];if(!n?.id)throw new Error("No active tab found.");return n.id}async function H(a,n){const h=(await chrome.scripting.executeScript({target:{tabId:a},func:o=>{const l=x=>x.replace(/\s+/g," ").trim().slice(0,o),s=window.getSelection?.()?.toString()?.trim()??"";if(s.length>40)return l(s);const f=document.querySelector("article"),u=document.querySelector("main"),d=f?.textContent||u?.textContent||document.body?.textContent||"";return l(d)},args:[n]}))?.[0]?.result??"";if(typeof h!="string"||h.length<20)throw new Error("Could not extract readable text from the page.");return h}function L(a){return["Build an easily digestible summary of the following webpage, make it easy to read for any user demographic.","Be funny or witty when possible.","Return:","1) A 1-sentence overview","2) up to 3 key bullet points","3) Any notable names/figures (if present)","","WEBPAGE CONTENT:",a].join(`
`)}function W(){return e.jsx("div",{className:`${t.bubble} ${t["bot-message"]}`,children:e.jsxs("div",{className:t.loading,children:[e.jsx("div",{className:t.line}),e.jsx("div",{className:t.line}),e.jsx("div",{className:t.line})]})})}function Y({m:a,showCursor:n}){const m=a.role==="assistant"?`${t.bubble} ${t["bot-message"]}`:`${t.bubble} ${t["user-message"]}`;return e.jsx("div",{className:m,children:e.jsxs("span",{children:[a.content,n&&e.jsx("span",{className:t.cursor})]})})}function U(){const[a,n]=b.useState([]),[m,h]=b.useState(""),[o,l]=b.useState(!1),[s,f]=b.useState(!1),u=b.useRef(null),d=b.useRef(null),x=b.useRef(null),y=b.useRef(0),_=b.useRef(!1);b.useEffect(()=>{x.current?.scrollIntoView({behavior:"smooth"})},[a,o,s]);function j(r,i=12,p=y.current){f(!0),n(g=>[...g,{role:"assistant",content:""}]);let c=0;d.current=window.setInterval(()=>{if(_.current||p!==y.current){d.current&&clearInterval(d.current),d.current=null,f(!1);return}c++,n(g=>{const w=g.slice(),v=w[w.length-1];return!v||v.role!=="assistant"?g:(w[w.length-1]={...v,content:r.slice(0,c)},w)}),c>=r.length&&(d.current&&clearInterval(d.current),d.current=null,f(!1))},i)}async function N(r){const i=m.trim();if(!i||o||s)return;const p=[...a,{role:"user",content:i}];n(p),h("");const c=++y.current;_.current=!1,l(!0),u.current=new AbortController;try{const g=await k(p,u.current.signal);if(_.current||c!==y.current)return;l(!1),j(g,12,c)}catch{_.current||(l(!1),n(g=>[...g,{role:"assistant",content:"Error calling model."}]))}finally{c===y.current&&(u.current=null)}}async function C(r,i){if(o||s)return;n(c=>[...c,{role:"user",content:r}]);const p=++y.current;_.current=!1,l(!0),u.current=new AbortController;try{const c=[...a,{role:"user",content:i}],g=await k(c,u.current.signal);if(_.current||p!==y.current)return;l(!1),j(g,12,p)}catch{_.current||(l(!1),n(c=>[...c,{role:"assistant",content:"Error calling model."}]))}finally{p===y.current&&(u.current=null)}}async function R(){if(!(o||s))try{const r=await $(),i=await H(r,12e3),p=L(i);await C("Summarize the current page, please.",p)}catch(r){n(i=>[...i,{role:"assistant",content:`Could not read this page. If this is a restricted page or missing permissions, try another site.

`+String(r?.message??r)}])}}function S(){_.current=!0,u.current?.abort(),u.current=null,d.current&&(clearInterval(d.current),d.current=null),l(!1),f(!1)}function E(){S(),n([])}return e.jsxs("div",{className:t["chatbox-wrapper"],children:[e.jsxs("div",{className:t.toolbar,children:[e.jsx("div",{className:t.title,children:e.jsx("span",{children:"PAGE SUMMARY / Q&A"})}),e.jsxs("div",{className:t["toolbar-buttons"],children:[e.jsx("button",{className:t["toolbar-button"],title:"Clear Chat",onClick:E,children:"ðŸ—‘ï¸"}),e.jsx("button",{className:t["settings-button"],title:"Settings",onClick:()=>chrome.runtime.openOptionsPage(),children:"âš™ï¸"})]})]}),e.jsxs("div",{className:t["chat-container"],children:[a.map((r,i)=>e.jsx(Y,{m:r,showCursor:s&&i===a.length-1&&r.role==="assistant"},i)),o&&e.jsx(W,{}),e.jsx("div",{ref:x})]}),e.jsxs("div",{className:t["input-container"],children:[e.jsxs("div",{className:t["input-row"],children:[e.jsx("textarea",{className:t["message-input"],placeholder:"Ask anything about the current page...",value:m,onChange:r=>h(r.target.value),onKeyDown:r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),N())}}),e.jsx("button",{className:t["send-btn"],onClick:()=>N(),disabled:!m.trim()||o||s,children:"ASK"}),e.jsx("button",{className:t["stop-btn"],onClick:S,disabled:!o&&!s,children:"STOP"})]}),e.jsx("button",{onClick:R,disabled:o||s,className:t["summarize-btn"],children:"SUMMARIZE"})]})]})}A.createRoot(document.getElementById("root")).render(e.jsx(U,{}));
