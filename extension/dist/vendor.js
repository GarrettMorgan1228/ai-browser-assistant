function ut(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var vt={exports:{}},bt={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kr;function fa(){return Kr||(Kr=1,(function(n){function e(v,w){var E=v.length;v.push(w);e:for(;0<E;){var x=E-1>>>1,P=v[x];if(0<s(P,w))v[x]=w,v[E]=P,E=x;else break e}}function t(v){return v.length===0?null:v[0]}function r(v){if(v.length===0)return null;var w=v[0],E=v.pop();if(E!==w){v[0]=E;e:for(var x=0,P=v.length,G=P>>>1;x<G;){var D=2*(x+1)-1,V=v[D],W=D+1,K=v[W];if(0>s(V,E))W<P&&0>s(K,V)?(v[x]=K,v[W]=E,x=W):(v[x]=V,v[D]=E,x=D);else if(W<P&&0>s(K,E))v[x]=K,v[W]=E,x=W;else break e}}return w}function s(v,w){var E=v.sortIndex-w.sortIndex;return E!==0?E:v.id-w.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var i=Date,o=i.now();n.unstable_now=function(){return i.now()-o}}var c=[],u=[],l=1,d=null,f=3,p=!1,h=!1,m=!1,g=!1,_=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;function N(v){for(var w=t(u);w!==null;){if(w.callback===null)r(u);else if(w.startTime<=v)r(u),w.sortIndex=w.expirationTime,e(c,w);else break;w=t(u)}}function R(v){if(m=!1,N(v),!h)if(t(c)!==null)h=!0,L||(L=!0,re());else{var w=t(u);w!==null&&O(R,w.startTime-v)}}var L=!1,M=-1,$=5,Y=-1;function te(){return g?!0:!(n.unstable_now()-Y<$)}function ae(){if(g=!1,L){var v=n.unstable_now();Y=v;var w=!0;try{e:{h=!1,m&&(m=!1,b(M),M=-1),p=!0;var E=f;try{t:{for(N(v),d=t(c);d!==null&&!(d.expirationTime>v&&te());){var x=d.callback;if(typeof x=="function"){d.callback=null,f=d.priorityLevel;var P=x(d.expirationTime<=v);if(v=n.unstable_now(),typeof P=="function"){d.callback=P,N(v),w=!0;break t}d===t(c)&&r(c),N(v)}else r(c);d=t(c)}if(d!==null)w=!0;else{var G=t(u);G!==null&&O(R,G.startTime-v),w=!1}}break e}finally{d=null,f=E,p=!1}w=void 0}}finally{w?re():L=!1}}}var re;if(typeof y=="function")re=function(){y(ae)};else if(typeof MessageChannel<"u"){var Ae=new MessageChannel,I=Ae.port2;Ae.port1.onmessage=ae,re=function(){I.postMessage(null)}}else re=function(){_(ae,0)};function O(v,w){M=_(function(){v(n.unstable_now())},w)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(v){v.callback=null},n.unstable_forceFrameRate=function(v){0>v||125<v?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<v?Math.floor(1e3/v):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_next=function(v){switch(f){case 1:case 2:case 3:var w=3;break;default:w=f}var E=f;f=w;try{return v()}finally{f=E}},n.unstable_requestPaint=function(){g=!0},n.unstable_runWithPriority=function(v,w){switch(v){case 1:case 2:case 3:case 4:case 5:break;default:v=3}var E=f;f=v;try{return w()}finally{f=E}},n.unstable_scheduleCallback=function(v,w,E){var x=n.unstable_now();switch(typeof E=="object"&&E!==null?(E=E.delay,E=typeof E=="number"&&0<E?x+E:x):E=x,v){case 1:var P=-1;break;case 2:P=250;break;case 5:P=1073741823;break;case 4:P=1e4;break;default:P=5e3}return P=E+P,v={id:l++,callback:w,priorityLevel:v,startTime:E,expirationTime:P,sortIndex:-1},E>x?(v.sortIndex=E,e(u,v),t(c)===null&&v===t(u)&&(m?(b(M),M=-1):m=!0,O(R,E-x))):(v.sortIndex=P,e(c,v),h||p||(h=!0,L||(L=!0,re()))),v},n.unstable_shouldYield=te,n.unstable_wrapCallback=function(v){var w=f;return function(){var E=f;f=w;try{return v.apply(this,arguments)}finally{f=E}}}})(bt)),bt}var Wr;function Eu(){return Wr||(Wr=1,vt.exports=fa()),vt.exports}var wt,Xr;function ha(){return Xr||(Xr=1,wt=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),wt}var pa=ha();const Su=ut(pa);var Be={exports:{}},Qr;function ma(){if(Qr)return Be.exports;Qr=1;const n=/[\p{Lu}]/u,e=/[\p{Ll}]/u,t=/^[\p{Lu}](?![\p{Lu}])/gu,r=/([\p{Alpha}\p{N}_]|$)/u,s=/[_.\- ]+/,a=new RegExp("^"+s.source),i=new RegExp(s.source+r.source,"gu"),o=new RegExp("\\d+"+r.source,"gu"),c=(f,p,h)=>{let m=!1,g=!1,_=!1;for(let b=0;b<f.length;b++){const y=f[b];m&&n.test(y)?(f=f.slice(0,b)+"-"+f.slice(b),m=!1,_=g,g=!0,b++):g&&_&&e.test(y)?(f=f.slice(0,b-1)+"-"+f.slice(b-1),_=g,g=!1,m=!0):(m=p(y)===y&&h(y)!==y,_=g,g=h(y)===y&&p(y)!==y)}return f},u=(f,p)=>(t.lastIndex=0,f.replace(t,h=>p(h))),l=(f,p)=>(i.lastIndex=0,o.lastIndex=0,f.replace(i,(h,m)=>p(m)).replace(o,h=>p(h))),d=(f,p)=>{if(!(typeof f=="string"||Array.isArray(f)))throw new TypeError("Expected the input to be `string | string[]`");if(p={pascalCase:!1,preserveConsecutiveUppercase:!1,...p},Array.isArray(f)?f=f.map(_=>_.trim()).filter(_=>_.length).join("-"):f=f.trim(),f.length===0)return"";const h=p.locale===!1?_=>_.toLowerCase():_=>_.toLocaleLowerCase(p.locale),m=p.locale===!1?_=>_.toUpperCase():_=>_.toLocaleUpperCase(p.locale);return f.length===1?p.pascalCase?m(f):h(f):(f!==h(f)&&(f=c(f,h,m)),f=f.replace(a,""),p.preserveConsecutiveUppercase?f=u(f,h):f=h(f),p.pascalCase&&(f=m(f.charAt(0))+f.slice(1)),l(f,m))};return Be.exports=d,Be.exports.default=d,Be.exports}ma();var B;(function(n){n.assertEqual=s=>{};function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{const a={};for(const i of s)a[i]=i;return a},n.getValidEnumValues=s=>{const a=n.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(const o of a)i[o]=s[o];return n.objectValues(i)},n.objectValues=s=>n.objectKeys(s).map(function(a){return s[a]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},n.find=(s,a)=>{for(const i of s)if(a(i))return i},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}n.joinValues=r,n.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(B||(B={}));var Yr;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(Yr||(Yr={}));const k=B.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),we=n=>{switch(typeof n){case"undefined":return k.undefined;case"string":return k.string;case"number":return Number.isNaN(n)?k.nan:k.number;case"boolean":return k.boolean;case"function":return k.function;case"bigint":return k.bigint;case"symbol":return k.symbol;case"object":return Array.isArray(n)?k.array:n===null?k.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?k.promise:typeof Map<"u"&&n instanceof Map?k.map:typeof Set<"u"&&n instanceof Set?k.set:typeof Date<"u"&&n instanceof Date?k.date:k.object;default:return k.unknown}},S=B.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class ve extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(a){return a.message},r={_errors:[]},s=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)r._errors.push(t(i));else{let o=r,c=0;for(;c<i.path.length;){const u=i.path[c];c===i.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(t(i))):o[u]=o[u]||{_errors:[]},o=o[u],c++}}};return s(this),r}static assert(e){if(!(e instanceof ve))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,B.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const s of this.issues)if(s.path.length>0){const a=s.path[0];t[a]=t[a]||[],t[a].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}ve.create=n=>new ve(n);const Pr=(n,e)=>{let t;switch(n.code){case S.invalid_type:n.received===k.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case S.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,B.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:t=`Unrecognized key(s) in object: ${B.joinValues(n.keys,", ")}`;break;case S.invalid_union:t="Invalid input";break;case S.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${B.joinValues(n.options)}`;break;case S.invalid_enum_value:t=`Invalid enum value. Expected ${B.joinValues(n.options)}, received '${n.received}'`;break;case S.invalid_arguments:t="Invalid function arguments";break;case S.invalid_return_type:t="Invalid function return type";break;case S.invalid_date:t="Invalid date";break;case S.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:B.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case S.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="bigint"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case S.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case S.custom:t="Invalid input";break;case S.invalid_intersection_types:t="Intersection results could not be merged";break;case S.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case S.not_finite:t="Number must be finite";break;default:t=e.defaultError,B.assertNever(n)}return{message:t}};let ga=Pr;function _a(){return ga}const ya=n=>{const{data:e,path:t,errorMaps:r,issueData:s}=n,a=[...t,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="";const c=r.filter(u=>!!u).slice().reverse();for(const u of c)o=u(i,{data:e,defaultError:o}).message;return{...s,path:a,message:o}};function A(n,e){const t=_a(),r=ya({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===Pr?void 0:Pr].filter(s=>!!s)});n.common.issues.push(r)}class ce{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if(s.status==="aborted")return U;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const s of t){const a=await s.key,i=await s.value;r.push({key:a,value:i})}return ce.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return U;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(r[a.value]=i.value)}return{status:e.value,value:r}}}const U=Object.freeze({status:"aborted"}),qe=n=>({status:"dirty",value:n}),le=n=>({status:"valid",value:n}),en=n=>n.status==="aborted",tn=n=>n.status==="dirty",$e=n=>n.status==="valid",Ye=n=>typeof Promise<"u"&&n instanceof Promise;var C;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message})(C||(C={}));class Te{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const rn=(n,e)=>{if($e(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ve(n.common.issues);return this._error=t,this._error}}};function F(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{const{message:c}=n;return i.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:c??r??o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:c??t??o.defaultError}},description:s}}class Z{get description(){return this._def.description}_getType(e){return we(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:we(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ce,ctx:{common:e.parent.common,data:e.data,parsedType:we(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Ye(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){const r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:we(e)},s=this._parseSync({data:e,path:r.path,parent:r});return rn(r,s)}"~validate"(e){const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:we(e)};if(!this["~standard"].async)try{const r=this._parseSync({data:e,path:[],parent:t});return $e(r)?{value:r.value}:{issues:t.common.issues}}catch(r){r?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(r=>$e(r)?{value:r.value}:{issues:t.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:we(e)},s=this._parse({data:e,path:r.path,parent:r}),a=await(Ye(s)?s:Promise.resolve(s));return rn(r,a)}refine(e,t){const r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,a)=>{const i=e(s),o=()=>a.addIssue({code:S.custom,...r(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new Ne({schema:this,typeName:T.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Se.create(this,this._def)}nullable(){return Ce.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ge.create(this)}promise(){return nt.create(this,this._def)}or(e){return tt.create([this,e],this._def)}and(e){return rt.create(this,e,this._def)}transform(e){return new Ne({...F(this._def),schema:this,typeName:T.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new jr({...F(this._def),innerType:this,defaultValue:t,typeName:T.ZodDefault})}brand(){return new za({typeName:T.ZodBranded,type:this,...F(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Lr({...F(this._def),innerType:this,catchValue:t,typeName:T.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return zr.create(this,e)}readonly(){return Ur.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const va=/^c[^\s-]{8,}$/i,ba=/^[0-9a-z]+$/,wa=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Ea=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Sa=/^[a-z0-9_-]{21}$/i,Ta=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Oa=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,xa=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Aa="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Et;const Ra=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ia=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ka=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,$a=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Pa=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Na=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Ms="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Ca=new RegExp(`^${Ms}$`);function qs(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);const t=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function ja(n){return new RegExp(`^${qs(n)}$`)}function La(n){let e=`${Ms}T${qs(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Ua(n,e){return!!((e==="v4"||!e)&&Ra.test(n)||(e==="v6"||!e)&&ka.test(n))}function Da(n,e){if(!Ta.test(n))return!1;try{const[t]=n.split(".");if(!t)return!1;const r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||"typ"in s&&s?.typ!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function Ma(n,e){return!!((e==="v4"||!e)&&Ia.test(n)||(e==="v6"||!e)&&$a.test(n))}class Ee extends Z{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==k.string){const a=this._getOrReturnCtx(e);return A(a,{code:S.invalid_type,expected:k.string,received:a.parsedType}),U}const r=new ce;let s;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),A(s,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),A(s,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(e,s),i?A(s,{code:S.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&A(s,{code:S.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")xa.test(e.data)||(s=this._getOrReturnCtx(e,s),A(s,{validation:"email",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Et||(Et=new RegExp(Aa,"u")),Et.test(e.data)||(s=this._getOrReturnCtx(e,s),A(s,{validation:"emoji",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")Ea.test(e.data)||(s=this._getOrReturnCtx(e,s),A(s,{validation:"uuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")Sa.test(e.data)||(s=this._getOrReturnCtx(e,s),A(s,{validation:"nanoid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")va.test(e.data)||(s=this._getOrReturnCtx(e,s),A(s,{validation:"cuid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")ba.test(e.data)||(s=this._getOrReturnCtx(e,s),A(s,{validation:"cuid2",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")wa.test(e.data)||(s=this._getOrReturnCtx(e,s),A(s,{validation:"ulid",code:S.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),A(s,{validation:"url",code:S.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),A(s,{validation:"regex",code:S.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),A(s,{code:S.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),A(s,{code:S.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),A(s,{code:S.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?La(a).test(e.data)||(s=this._getOrReturnCtx(e,s),A(s,{code:S.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?Ca.test(e.data)||(s=this._getOrReturnCtx(e,s),A(s,{code:S.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?ja(a).test(e.data)||(s=this._getOrReturnCtx(e,s),A(s,{code:S.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?Oa.test(e.data)||(s=this._getOrReturnCtx(e,s),A(s,{validation:"duration",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?Ua(e.data,a.version)||(s=this._getOrReturnCtx(e,s),A(s,{validation:"ip",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?Da(e.data,a.alg)||(s=this._getOrReturnCtx(e,s),A(s,{validation:"jwt",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?Ma(e.data,a.version)||(s=this._getOrReturnCtx(e,s),A(s,{validation:"cidr",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?Pa.test(e.data)||(s=this._getOrReturnCtx(e,s),A(s,{validation:"base64",code:S.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?Na.test(e.data)||(s=this._getOrReturnCtx(e,s),A(s,{validation:"base64url",code:S.invalid_string,message:a.message}),r.dirty()):B.assertNever(a);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:S.invalid_string,...C.errToObj(r)})}_addCheck(e){return new Ee({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...C.errToObj(e)})}url(e){return this._addCheck({kind:"url",...C.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...C.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...C.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...C.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...C.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...C.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...C.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...C.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...C.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...C.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...C.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...C.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...C.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...C.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...C.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...C.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...C.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...C.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...C.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...C.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...C.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...C.errToObj(t)})}nonempty(e){return this.min(1,C.errToObj(e))}trim(){return new Ee({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ee({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ee({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Ee.create=n=>new Ee({checks:[],typeName:T.ZodString,coerce:n?.coerce??!1,...F(n)});function qa(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,a=Number.parseInt(n.toFixed(s).replace(".","")),i=Number.parseInt(e.toFixed(s).replace(".",""));return a%i/10**s}class ze extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==k.number){const a=this._getOrReturnCtx(e);return A(a,{code:S.invalid_type,expected:k.number,received:a.parsedType}),U}let r;const s=new ce;for(const a of this._def.checks)a.kind==="int"?B.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),A(r,{code:S.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),A(r,{code:S.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),A(r,{code:S.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?qa(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),A(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),A(r,{code:S.not_finite,message:a.message}),s.dirty()):B.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,C.toString(t))}gt(e,t){return this.setLimit("min",e,!1,C.toString(t))}lte(e,t){return this.setLimit("max",e,!0,C.toString(t))}lt(e,t){return this.setLimit("max",e,!1,C.toString(t))}setLimit(e,t,r,s){return new ze({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:C.toString(s)}]})}_addCheck(e){return new ze({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:C.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:C.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:C.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:C.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:C.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:C.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:C.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:C.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:C.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&B.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ze.create=n=>new ze({checks:[],typeName:T.ZodNumber,coerce:n?.coerce||!1,...F(n)});class Fe extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==k.bigint)return this._getInvalidInput(e);let r;const s=new ce;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),A(r,{code:S.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),A(r,{code:S.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),A(r,{code:S.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):B.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return A(t,{code:S.invalid_type,expected:k.bigint,received:t.parsedType}),U}gte(e,t){return this.setLimit("min",e,!0,C.toString(t))}gt(e,t){return this.setLimit("min",e,!1,C.toString(t))}lte(e,t){return this.setLimit("max",e,!0,C.toString(t))}lt(e,t){return this.setLimit("max",e,!1,C.toString(t))}setLimit(e,t,r,s){return new Fe({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:C.toString(s)}]})}_addCheck(e){return new Fe({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:C.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:C.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:C.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:C.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:C.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Fe.create=n=>new Fe({checks:[],typeName:T.ZodBigInt,coerce:n?.coerce??!1,...F(n)});class nn extends Z{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==k.boolean){const r=this._getOrReturnCtx(e);return A(r,{code:S.invalid_type,expected:k.boolean,received:r.parsedType}),U}return le(e.data)}}nn.create=n=>new nn({typeName:T.ZodBoolean,coerce:n?.coerce||!1,...F(n)});class et extends Z{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==k.date){const a=this._getOrReturnCtx(e);return A(a,{code:S.invalid_type,expected:k.date,received:a.parsedType}),U}if(Number.isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return A(a,{code:S.invalid_date}),U}const r=new ce;let s;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),A(s,{code:S.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),A(s,{code:S.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):B.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new et({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:C.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:C.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}et.create=n=>new et({checks:[],coerce:n?.coerce||!1,typeName:T.ZodDate,...F(n)});class sn extends Z{_parse(e){if(this._getType(e)!==k.symbol){const r=this._getOrReturnCtx(e);return A(r,{code:S.invalid_type,expected:k.symbol,received:r.parsedType}),U}return le(e.data)}}sn.create=n=>new sn({typeName:T.ZodSymbol,...F(n)});class an extends Z{_parse(e){if(this._getType(e)!==k.undefined){const r=this._getOrReturnCtx(e);return A(r,{code:S.invalid_type,expected:k.undefined,received:r.parsedType}),U}return le(e.data)}}an.create=n=>new an({typeName:T.ZodUndefined,...F(n)});class on extends Z{_parse(e){if(this._getType(e)!==k.null){const r=this._getOrReturnCtx(e);return A(r,{code:S.invalid_type,expected:k.null,received:r.parsedType}),U}return le(e.data)}}on.create=n=>new on({typeName:T.ZodNull,...F(n)});class Nr extends Z{constructor(){super(...arguments),this._any=!0}_parse(e){return le(e.data)}}Nr.create=n=>new Nr({typeName:T.ZodAny,...F(n)});class cn extends Z{constructor(){super(...arguments),this._unknown=!0}_parse(e){return le(e.data)}}cn.create=n=>new cn({typeName:T.ZodUnknown,...F(n)});class Oe extends Z{_parse(e){const t=this._getOrReturnCtx(e);return A(t,{code:S.invalid_type,expected:k.never,received:t.parsedType}),U}}Oe.create=n=>new Oe({typeName:T.ZodNever,...F(n)});class un extends Z{_parse(e){if(this._getType(e)!==k.undefined){const r=this._getOrReturnCtx(e);return A(r,{code:S.invalid_type,expected:k.void,received:r.parsedType}),U}return le(e.data)}}un.create=n=>new un({typeName:T.ZodVoid,...F(n)});class ge extends Z{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==k.array)return A(t,{code:S.invalid_type,expected:k.array,received:t.parsedType}),U;if(s.exactLength!==null){const i=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(i||o)&&(A(t,{code:i?S.too_big:S.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(A(t,{code:S.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(A(t,{code:S.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>s.type._parseAsync(new Te(t,i,t.path,o)))).then(i=>ce.mergeArray(r,i));const a=[...t.data].map((i,o)=>s.type._parseSync(new Te(t,i,t.path,o)));return ce.mergeArray(r,a)}get element(){return this._def.type}min(e,t){return new ge({...this._def,minLength:{value:e,message:C.toString(t)}})}max(e,t){return new ge({...this._def,maxLength:{value:e,message:C.toString(t)}})}length(e,t){return new ge({...this._def,exactLength:{value:e,message:C.toString(t)}})}nonempty(e){return this.min(1,e)}}ge.create=(n,e)=>new ge({type:n,minLength:null,maxLength:null,exactLength:null,typeName:T.ZodArray,...F(e)});function Re(n){if(n instanceof X){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=Se.create(Re(r))}return new X({...n._def,shape:()=>e})}else return n instanceof ge?new ge({...n._def,type:Re(n.element)}):n instanceof Se?Se.create(Re(n.unwrap())):n instanceof Ce?Ce.create(Re(n.unwrap())):n instanceof xe?xe.create(n.items.map(e=>Re(e))):n}class X extends Z{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=B.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==k.object){const u=this._getOrReturnCtx(e);return A(u,{code:S.invalid_type,expected:k.object,received:u.parsedType}),U}const{status:r,ctx:s}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof Oe&&this._def.unknownKeys==="strip"))for(const u in s.data)i.includes(u)||o.push(u);const c=[];for(const u of i){const l=a[u],d=s.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new Te(s,d,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof Oe){const u=this._def.unknownKeys;if(u==="passthrough")for(const l of o)c.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(u==="strict")o.length>0&&(A(s,{code:S.unrecognized_keys,keys:o}),r.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const l of o){const d=s.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new Te(s,d,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const u=[];for(const l of c){const d=await l.key,f=await l.value;u.push({key:d,value:f,alwaysSet:l.alwaysSet})}return u}).then(u=>ce.mergeObjectSync(r,u)):ce.mergeObjectSync(r,c)}get shape(){return this._def.shape()}strict(e){return C.errToObj,new X({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{const s=this._def.errorMap?.(t,r).message??r.defaultError;return t.code==="unrecognized_keys"?{message:C.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new X({...this._def,unknownKeys:"strip"})}passthrough(){return new X({...this._def,unknownKeys:"passthrough"})}extend(e){return new X({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new X({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:T.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new X({...this._def,catchall:e})}pick(e){const t={};for(const r of B.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new X({...this._def,shape:()=>t})}omit(e){const t={};for(const r of B.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new X({...this._def,shape:()=>t})}deepPartial(){return Re(this)}partial(e){const t={};for(const r of B.objectKeys(this.shape)){const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}return new X({...this._def,shape:()=>t})}required(e){const t={};for(const r of B.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let a=this.shape[r];for(;a instanceof Se;)a=a._def.innerType;t[r]=a}return new X({...this._def,shape:()=>t})}keyof(){return zs(B.objectKeys(this.shape))}}X.create=(n,e)=>new X({shape:()=>n,unknownKeys:"strip",catchall:Oe.create(),typeName:T.ZodObject,...F(e)});X.strictCreate=(n,e)=>new X({shape:()=>n,unknownKeys:"strict",catchall:Oe.create(),typeName:T.ZodObject,...F(e)});X.lazycreate=(n,e)=>new X({shape:n,unknownKeys:"strip",catchall:Oe.create(),typeName:T.ZodObject,...F(e)});class tt extends Z{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function s(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new ve(o.ctx.common.issues));return A(t,{code:S.invalid_union,unionErrors:i}),U}if(t.common.async)return Promise.all(r.map(async a=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(s);{let a;const i=[];for(const c of r){const u={...t,common:{...t.common,issues:[]},parent:null},l=c._parseSync({data:t.data,path:t.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!a&&(a={result:l,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(c=>new ve(c));return A(t,{code:S.invalid_union,unionErrors:o}),U}}get options(){return this._def.options}}tt.create=(n,e)=>new tt({options:n,typeName:T.ZodUnion,...F(e)});function Cr(n,e){const t=we(n),r=we(e);if(n===e)return{valid:!0,data:n};if(t===k.object&&r===k.object){const s=B.objectKeys(e),a=B.objectKeys(n).filter(o=>s.indexOf(o)!==-1),i={...n,...e};for(const o of a){const c=Cr(n[o],e[o]);if(!c.valid)return{valid:!1};i[o]=c.data}return{valid:!0,data:i}}else if(t===k.array&&r===k.array){if(n.length!==e.length)return{valid:!1};const s=[];for(let a=0;a<n.length;a++){const i=n[a],o=e[a],c=Cr(i,o);if(!c.valid)return{valid:!1};s.push(c.data)}return{valid:!0,data:s}}else return t===k.date&&r===k.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class rt extends Z{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(a,i)=>{if(en(a)||en(i))return U;const o=Cr(a.value,i.value);return o.valid?((tn(a)||tn(i))&&t.dirty(),{status:t.value,value:o.data}):(A(r,{code:S.invalid_intersection_types}),U)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}rt.create=(n,e,t)=>new rt({left:n,right:e,typeName:T.ZodIntersection,...F(t)});class xe extends Z{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==k.array)return A(r,{code:S.invalid_type,expected:k.array,received:r.parsedType}),U;if(r.data.length<this._def.items.length)return A(r,{code:S.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),U;!this._def.rest&&r.data.length>this._def.items.length&&(A(r,{code:S.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...r.data].map((i,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new Te(r,i,r.path,o)):null}).filter(i=>!!i);return r.common.async?Promise.all(a).then(i=>ce.mergeArray(t,i)):ce.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new xe({...this._def,rest:e})}}xe.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new xe({items:n,typeName:T.ZodTuple,rest:null,...F(e)})};class ln extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==k.map)return A(r,{code:S.invalid_type,expected:k.map,received:r.parsedType}),U;const s=this._def.keyType,a=this._def.valueType,i=[...r.data.entries()].map(([o,c],u)=>({key:s._parse(new Te(r,o,r.path,[u,"key"])),value:a._parse(new Te(r,c,r.path,[u,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of i){const u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return U;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(u.value,l.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const c of i){const u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return U;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(u.value,l.value)}return{status:t.value,value:o}}}}ln.create=(n,e,t)=>new ln({valueType:e,keyType:n,typeName:T.ZodMap,...F(t)});class Ge extends Z{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==k.set)return A(r,{code:S.invalid_type,expected:k.set,received:r.parsedType}),U;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(A(r,{code:S.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(A(r,{code:S.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const a=this._def.valueType;function i(c){const u=new Set;for(const l of c){if(l.status==="aborted")return U;l.status==="dirty"&&t.dirty(),u.add(l.value)}return{status:t.value,value:u}}const o=[...r.data.values()].map((c,u)=>a._parse(new Te(r,c,r.path,u)));return r.common.async?Promise.all(o).then(c=>i(c)):i(o)}min(e,t){return new Ge({...this._def,minSize:{value:e,message:C.toString(t)}})}max(e,t){return new Ge({...this._def,maxSize:{value:e,message:C.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Ge.create=(n,e)=>new Ge({valueType:n,minSize:null,maxSize:null,typeName:T.ZodSet,...F(e)});class dn extends Z{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}dn.create=(n,e)=>new dn({getter:n,typeName:T.ZodLazy,...F(e)});class fn extends Z{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return A(t,{received:t.data,code:S.invalid_literal,expected:this._def.value}),U}return{status:"valid",value:e.data}}get value(){return this._def.value}}fn.create=(n,e)=>new fn({value:n,typeName:T.ZodLiteral,...F(e)});function zs(n,e){return new Pe({values:n,typeName:T.ZodEnum,...F(e)})}class Pe extends Z{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return A(t,{expected:B.joinValues(r),received:t.parsedType,code:S.invalid_type}),U}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return A(t,{received:t.data,code:S.invalid_enum_value,options:r}),U}return le(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Pe.create(e,{...this._def,...t})}exclude(e,t=this._def){return Pe.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}Pe.create=zs;class hn extends Z{_parse(e){const t=B.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==k.string&&r.parsedType!==k.number){const s=B.objectValues(t);return A(r,{expected:B.joinValues(s),received:r.parsedType,code:S.invalid_type}),U}if(this._cache||(this._cache=new Set(B.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const s=B.objectValues(t);return A(r,{received:r.data,code:S.invalid_enum_value,options:s}),U}return le(e.data)}get enum(){return this._def.values}}hn.create=(n,e)=>new hn({values:n,typeName:T.ZodNativeEnum,...F(e)});class nt extends Z{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==k.promise&&t.common.async===!1)return A(t,{code:S.invalid_type,expected:k.promise,received:t.parsedType}),U;const r=t.parsedType===k.promise?t.data:Promise.resolve(t.data);return le(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}nt.create=(n,e)=>new nt({type:n,typeName:T.ZodPromise,...F(e)});class Ne extends Z{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===T.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:i=>{A(r,i),i.fatal?t.abort():t.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){const i=s.transform(r.data,a);if(r.common.async)return Promise.resolve(i).then(async o=>{if(t.value==="aborted")return U;const c=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return c.status==="aborted"?U:c.status==="dirty"||t.value==="dirty"?qe(c.value):c});{if(t.value==="aborted")return U;const o=this._def.schema._parseSync({data:i,path:r.path,parent:r});return o.status==="aborted"?U:o.status==="dirty"||t.value==="dirty"?qe(o.value):o}}if(s.type==="refinement"){const i=o=>{const c=s.refinement(o,a);if(r.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?U:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?U:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){const i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!$e(i))return U;const o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>$e(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:t.value,value:o})):U);B.assertNever(s)}}Ne.create=(n,e,t)=>new Ne({schema:n,typeName:T.ZodEffects,effect:e,...F(t)});Ne.createWithPreprocess=(n,e,t)=>new Ne({schema:e,effect:{type:"preprocess",transform:n},typeName:T.ZodEffects,...F(t)});class Se extends Z{_parse(e){return this._getType(e)===k.undefined?le(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Se.create=(n,e)=>new Se({innerType:n,typeName:T.ZodOptional,...F(e)});class Ce extends Z{_parse(e){return this._getType(e)===k.null?le(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ce.create=(n,e)=>new Ce({innerType:n,typeName:T.ZodNullable,...F(e)});class jr extends Z{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===k.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}jr.create=(n,e)=>new jr({innerType:n,typeName:T.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...F(e)});class Lr extends Z{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Ye(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new ve(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ve(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Lr.create=(n,e)=>new Lr({innerType:n,typeName:T.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...F(e)});class pn extends Z{_parse(e){if(this._getType(e)!==k.nan){const r=this._getOrReturnCtx(e);return A(r,{code:S.invalid_type,expected:k.nan,received:r.parsedType}),U}return{status:"valid",value:e.data}}}pn.create=n=>new pn({typeName:T.ZodNaN,...F(n)});class za extends Z{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class zr extends Z{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?U:a.status==="dirty"?(t.dirty(),qe(a.value)):this._def.out._parseAsync({data:a.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?U:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new zr({in:e,out:t,typeName:T.ZodPipeline})}}class Ur extends Z{_parse(e){const t=this._def.innerType._parse(e),r=s=>($e(s)&&(s.value=Object.freeze(s.value)),s);return Ye(t)?t.then(s=>r(s)):r(t)}unwrap(){return this._def.innerType}}Ur.create=(n,e)=>new Ur({innerType:n,typeName:T.ZodReadonly,...F(e)});var T;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(T||(T={}));const Tu=Ee.create,Ou=Nr.create;Oe.create;ge.create;const xu=X.create;tt.create;rt.create;xe.create;Pe.create;nt.create;Se.create;Ce.create;var Ue={exports:{}},St={},Tt,mn;function Fa(){if(mn)return Tt;mn=1;function n(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return Tt=n,n.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},n.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},n.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var s=this;return this._timer=setTimeout(function(){s._attempts++,s._operationTimeoutCb&&(s._timeout=setTimeout(function(){s._operationTimeoutCb(s._attempts)},s._operationTimeout),s._options.unref&&s._timeout.unref()),s._fn(s._attempts)},r),this._options.unref&&this._timer.unref(),!0},n.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},n.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},n.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},n.prototype.start=n.prototype.try,n.prototype.errors=function(){return this._errors},n.prototype.attempts=function(){return this._attempts},n.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,r=0,s=0;s<this._errors.length;s++){var a=this._errors[s],i=a.message,o=(e[i]||0)+1;e[i]=o,o>=r&&(t=a,r=o)}return t},Tt}var gn;function Ga(){return gn||(gn=1,(function(n){var e=Fa();n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)r[s]=t[s];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],i=0;i<r.retries;i++)a.push(this.createTimeout(i,r));return t&&t.forever&&!a.length&&a.push(this.createTimeout(i,r)),a.sort(function(o,c){return o-c}),a},n.createTimeout=function(t,r){var s=r.randomize?Math.random()+1:1,a=Math.round(s*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return a=Math.min(a,r.maxTimeout),a},n.wrap=function(t,r,s){if(r instanceof Array&&(s=r,r=null),!s){s=[];for(var a in t)typeof t[a]=="function"&&s.push(a)}for(var i=0;i<s.length;i++){var o=s[i],c=t[o];t[o]=(function(l){var d=n.operation(r),f=Array.prototype.slice.call(arguments,1),p=f.pop();f.push(function(h){d.retry(h)||(h&&(arguments[0]=d.mainError()),p.apply(this,arguments))}),d.attempt(function(){l.apply(t,f)})}).bind(t,c),t[o].options=r}}})(St)),St}var Ot,_n;function Za(){return _n||(_n=1,Ot=Ga()),Ot}var yn;function Ba(){if(yn)return Ue.exports;yn=1;const n=Za(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(o){super(),o instanceof Error?(this.originalError=o,{message:o}=o):(this.originalError=new Error(o),this.originalError.stack=this.stack),this.name="AbortError",this.message=o}}const r=(i,o,c)=>{const u=c.retries-(o-1);return i.attemptNumber=o,i.retriesLeft=u,i},s=i=>e.includes(i),a=(i,o)=>new Promise((c,u)=>{o={onFailedAttempt:()=>{},retries:10,...o};const l=n.operation(o);l.attempt(async d=>{try{c(await i(d))}catch(f){if(!(f instanceof Error)){u(new TypeError(`Non-error was thrown: "${f}". You should only throw errors.`));return}if(f instanceof t)l.stop(),u(f.originalError);else if(f instanceof TypeError&&!s(f.message))l.stop(),u(f);else{r(f,d,o);try{await o.onFailedAttempt(f)}catch(p){u(p);return}l.retry(f)||u(l.mainError())}}})});return Ue.exports=a,Ue.exports.default=a,Ue.exports.AbortError=t,Ue.exports}var Ha=Ba();const Va=ut(Ha),Ja=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Ka(n){return typeof n=="string"&&Ja.test(n)}function Wa(n){if(!Ka(n))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var ee=[];for(var xt=0;xt<256;++xt)ee.push((xt+256).toString(16).slice(1));function Fs(n,e=0){return(ee[n[e+0]]+ee[n[e+1]]+ee[n[e+2]]+ee[n[e+3]]+"-"+ee[n[e+4]]+ee[n[e+5]]+"-"+ee[n[e+6]]+ee[n[e+7]]+"-"+ee[n[e+8]]+ee[n[e+9]]+"-"+ee[n[e+10]]+ee[n[e+11]]+ee[n[e+12]]+ee[n[e+13]]+ee[n[e+14]]+ee[n[e+15]]).toLowerCase()}var He,Xa=new Uint8Array(16);function Qa(){if(!He&&(He=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!He))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return He(Xa)}function Ya(n){n=unescape(encodeURIComponent(n));for(var e=[],t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}var ei="6ba7b810-9dad-11d1-80b4-00c04fd430c8",ti="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function ri(n,e,t){function r(s,a,i,o){var c;if(typeof s=="string"&&(s=Ya(s)),typeof a=="string"&&(a=Wa(a)),((c=a)===null||c===void 0?void 0:c.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var u=new Uint8Array(16+s.length);if(u.set(a),u.set(s,a.length),u=t(u),u[6]=u[6]&15|e,u[8]=u[8]&63|128,i){o=o||0;for(var l=0;l<16;++l)i[o+l]=u[l];return i}return Fs(u)}try{r.name=n}catch{}return r.DNS=ei,r.URL=ti,r}var ni=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const vn={randomUUID:ni};function Ie(n,e,t){if(vn.randomUUID&&!n)return vn.randomUUID();n=n||{};var r=n.random||(n.rng||Qa)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Fs(r)}function si(n,e,t,r){switch(n){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function At(n,e){return n<<e|n>>>32-e}function ai(n){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){var r=unescape(encodeURIComponent(n));n=[];for(var s=0;s<r.length;++s)n.push(r.charCodeAt(s))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);for(var a=n.length/4+2,i=Math.ceil(a/16),o=new Array(i),c=0;c<i;++c){for(var u=new Uint32Array(16),l=0;l<16;++l)u[l]=n[c*64+l*4]<<24|n[c*64+l*4+1]<<16|n[c*64+l*4+2]<<8|n[c*64+l*4+3];o[c]=u}o[i-1][14]=(n.length-1)*8/Math.pow(2,32),o[i-1][14]=Math.floor(o[i-1][14]),o[i-1][15]=(n.length-1)*8&4294967295;for(var d=0;d<i;++d){for(var f=new Uint32Array(80),p=0;p<16;++p)f[p]=o[d][p];for(var h=16;h<80;++h)f[h]=At(f[h-3]^f[h-8]^f[h-14]^f[h-16],1);for(var m=t[0],g=t[1],_=t[2],b=t[3],y=t[4],N=0;N<80;++N){var R=Math.floor(N/20),L=At(m,5)+si(R,g,_,b)+y+e[R]+f[N]>>>0;y=b,b=_,_=At(g,30)>>>0,g=m,m=L}t[0]=t[0]+m>>>0,t[1]=t[1]+g>>>0,t[2]=t[2]+_>>>0,t[3]=t[3]+b>>>0,t[4]=t[4]+y>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var bn=ri("v5",80,ai);class ii{getStore(){}run(e,t){return t()}}const Rt=Symbol.for("ls:tracing_async_local_storage"),oi=new ii;class ci{getInstance(){return globalThis[Rt]??oi}initializeGlobalInstance(e){globalThis[Rt]===void 0&&(globalThis[Rt]=e)}}const ui=new ci;function Au(n=!1){const e=ui.getInstance().getStore();if(!n&&e===void 0)throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}function Ru(n){return typeof n=="function"&&"langsmith:traceable"in n}const li="gen_ai.operation.name",di="gen_ai.system",wn="gen_ai.request.model",fi="gen_ai.response.model",En="gen_ai.usage.input_tokens",Sn="gen_ai.usage.output_tokens",Tn="gen_ai.usage.total_tokens",hi="gen_ai.request.max_tokens",pi="gen_ai.request.temperature",mi="gen_ai.request.top_p",gi="gen_ai.request.frequency_penalty",_i="gen_ai.request.presence_penalty",yi="gen_ai.response.finish_reasons",vi="gen_ai.prompt",bi="gen_ai.completion",wi="gen_ai.request.extra_query",Ei="gen_ai.request.extra_body",Si="gen_ai.serialized.name",Ti="gen_ai.serialized.signature",Oi="gen_ai.serialized.doc",xi="gen_ai.response.id",Ai="gen_ai.response.service_tier",Ri="gen_ai.response.system_fingerprint",Ii="gen_ai.usage.input_token_details",ki="gen_ai.usage.output_token_details",$i="langsmith.trace.session_id",Pi="langsmith.trace.session_name",Ni="langsmith.span.kind",Ci="langsmith.trace.name",ji="langsmith.metadata",On="langsmith.span.tags",Li="langsmith.request.streaming",Ui="langsmith.request.headers",Di=(...n)=>fetch(...n),Gs=Symbol.for("ls:fetch_implementation"),Mi=()=>{const n=globalThis[Gs];return n?typeof n=="function"&&"Headers"in n&&"Request"in n&&"Response"in n:!1},j=n=>async(...e)=>{if(n||oe("DEBUG")==="true"){const[r,s]=e;console.log(` ${s?.method||"GET"} ${r}`)}const t=await(globalThis[Gs]??Di)(...e);return(n||oe("DEBUG")==="true")&&console.log(` ${t.status} ${t.statusText} ${t.url}`),t},qi=()=>oe("PROJECT")??_e("LANGCHAIN_SESSION")??"default",Zs="0.3.61";var Dr={};let ye;const zi=()=>typeof window<"u"&&typeof window.document<"u",Fi=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Gi=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),Bs=()=>typeof Deno<"u",Zi=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Bs(),Bi=()=>ye||(zi()?ye="browser":Zi()?ye="node":Fi()?ye="webworker":Gi()?ye="jsdom":Bs()?ye="deno":ye="other",ye);let It;function Hs(){if(It===void 0){const n=Bi(),e=Ji();It={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:Zs,...e}}return It}function Hi(){const n=Vi()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[r,s]of Object.entries(n))(r.startsWith("LANGCHAIN_")||r.startsWith("LANGSMITH_"))&&typeof s=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[r]=s);return e}function Vi(){try{return typeof process<"u"&&Dr?Object.entries(Dr).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function _e(n){try{return typeof process<"u"?Dr?.[n]:void 0}catch{return}}function oe(n){return _e(`LANGSMITH_${n}`)||_e(`LANGCHAIN_${n}`)}let kt;function Ji(){if(kt!==void 0)return kt;const n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of n){const r=_e(t);r!==void 0&&(e[t]=r)}return kt=e,e}function Vs(){return _e("OTEL_ENABLED")==="true"||oe("OTEL_ENABLED")==="true"}class Ki{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){!this.hasWarned&&Vs()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0);let r;if(t.length===1&&typeof t[0]=="function"?r=t[0]:t.length===2&&typeof t[1]=="function"?r=t[1]:t.length===3&&typeof t[2]=="function"&&(r=t[2]),typeof r=="function")return r()}}class Wi{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new Ki})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}}class Xi{active(){return{}}with(e,t){return t()}}const $t=Symbol.for("ls:otel_trace"),Pt=Symbol.for("ls:otel_context"),xn=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),Qi=new Wi,Yi=new Xi;class eo{getTraceInstance(){return globalThis[$t]??Qi}getContextInstance(){return globalThis[Pt]??Yi}initializeGlobalInstances(e){globalThis[$t]===void 0&&(globalThis[$t]=e.trace),globalThis[Pt]===void 0&&(globalThis[Pt]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[xn]=e}getDefaultOTLPTracerComponents(){return globalThis[xn]??void 0}}const Fr=new eo;function Js(){return Fr.getTraceInstance()}function to(){return Fr.getContextInstance()}function ro(){return Fr.getDefaultOTLPTracerComponents()}const no={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};function so(n){return no[n]||n}class ao{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(const r of e)try{if(!r.run)continue;if(r.operation==="post"){const s=this.createSpanForRun(r,r.run,t.get(r.id));s&&!r.run.end_time&&this.spans.set(r.id,s)}else this.updateSpanForRun(r,r.run)}catch(s){console.error(`Error processing operation ${r.id}:`,s)}}createSpanForRun(e,t,r){const s=r&&Js().getSpan(r);if(s)try{return this.finishSpanSetup(s,t,e)}catch(a){console.error(`Failed to create span for run ${e.id}:`,a);return}}finishSpanSetup(e,t,r){return this.setSpanAttributes(e,t,r),t.error?(e.setStatus({code:2}),e.recordException(new Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{const r=this.spans.get(e.id);if(!r){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(r,t,e),t.error?(r.setStatus({code:2}),r.recordException(new Error(t.error))):r.setStatus({code:1});const s=t.end_time;s&&(r.end(new Date(s)),this.spans.delete(e.id))}catch(r){console.error(`Failed to update span for run ${e.id}:`,r)}}extractModelName(e){if(e.extra?.metadata){const t=e.extra.metadata;if(t.ls_model_name)return t.ls_model_name;if(t.invocation_params){const r=t.invocation_params;if(r.model)return r.model;if(r.model_name)return r.model_name}}}setSpanAttributes(e,t,r){if("run_type"in t&&t.run_type){e.setAttribute(Ni,t.run_type);const o=so(t.run_type||"chain");e.setAttribute(li,o)}"name"in t&&t.name&&e.setAttribute(Ci,t.name),"session_id"in t&&t.session_id&&e.setAttribute($i,t.session_id),"session_name"in t&&t.session_name&&e.setAttribute(Pi,t.session_name),this.setGenAiSystem(e,t);const s=this.extractModelName(t);s&&e.setAttribute(wn,s),"prompt_tokens"in t&&typeof t.prompt_tokens=="number"&&e.setAttribute(En,t.prompt_tokens),"completion_tokens"in t&&typeof t.completion_tokens=="number"&&e.setAttribute(Sn,t.completion_tokens),"total_tokens"in t&&typeof t.total_tokens=="number"&&e.setAttribute(Tn,t.total_tokens),this.setInvocationParameters(e,t);const a=t.extra?.metadata||{};for(const[o,c]of Object.entries(a))c!=null&&e.setAttribute(`${ji}.${o}`,String(c));const i=t.tags;if(i&&Array.isArray(i)?e.setAttribute(On,i.join(", ")):i&&e.setAttribute(On,String(i)),"serialized"in t&&typeof t.serialized=="object"){const o=t.serialized;o.name&&e.setAttribute(Si,String(o.name)),o.signature&&e.setAttribute(Ti,String(o.signature)),o.doc&&e.setAttribute(Oi,String(o.doc))}this.setIOAttributes(e,r)}setGenAiSystem(e,t){let r="langchain";const s=this.extractModelName(t);if(s){const a=s.toLowerCase();a.includes("anthropic")||a.startsWith("claude")?r="anthropic":a.includes("bedrock")?r="aws.bedrock":a.includes("azure")&&a.includes("openai")?r="az.ai.openai":a.includes("azure")&&a.includes("inference")?r="az.ai.inference":a.includes("cohere")?r="cohere":a.includes("deepseek")?r="deepseek":a.includes("gemini")?r="gemini":a.includes("groq")?r="groq":a.includes("watson")||a.includes("ibm")?r="ibm.watsonx.ai":a.includes("mistral")?r="mistral_ai":a.includes("gpt")||a.includes("openai")?r="openai":a.includes("perplexity")||a.includes("sonar")?r="perplexity":a.includes("vertex")?r="vertex_ai":(a.includes("xai")||a.includes("grok"))&&(r="xai")}e.setAttribute(di,r)}setInvocationParameters(e,t){if(!t.extra?.metadata?.invocation_params)return;const r=t.extra.metadata.invocation_params;r.max_tokens!==void 0&&e.setAttribute(hi,r.max_tokens),r.temperature!==void 0&&e.setAttribute(pi,r.temperature),r.top_p!==void 0&&e.setAttribute(mi,r.top_p),r.frequency_penalty!==void 0&&e.setAttribute(gi,r.frequency_penalty),r.presence_penalty!==void 0&&e.setAttribute(_i,r.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{const r=t.run.inputs;typeof r=="object"&&r!==null&&(r.model&&Array.isArray(r.messages)&&e.setAttribute(wn,r.model),r.stream!==void 0&&e.setAttribute(Li,r.stream),r.extra_headers&&e.setAttribute(Ui,JSON.stringify(r.extra_headers)),r.extra_query&&e.setAttribute(wi,JSON.stringify(r.extra_query)),r.extra_body&&e.setAttribute(Ei,JSON.stringify(r.extra_body))),e.setAttribute(vi,JSON.stringify(r))}catch(r){console.debug(`Failed to process inputs for run ${t.id}`,r)}if(t.run.outputs)try{const r=t.run.outputs,s=this.getUnifiedRunTokens(r);if(s&&(e.setAttribute(En,s[0]),e.setAttribute(Sn,s[1]),e.setAttribute(Tn,s[0]+s[1])),r&&typeof r=="object"){if(r.model&&e.setAttribute(fi,String(r.model)),r.id&&e.setAttribute(xi,r.id),r.choices&&Array.isArray(r.choices)){const a=r.choices.map(i=>i.finish_reason).filter(i=>i).map(String);a.length>0&&e.setAttribute(yi,a.join(", "))}if(r.service_tier&&e.setAttribute(Ai,r.service_tier),r.system_fingerprint&&e.setAttribute(Ri,r.system_fingerprint),r.usage_metadata&&typeof r.usage_metadata=="object"){const a=r.usage_metadata;a.input_token_details&&e.setAttribute(Ii,JSON.stringify(a.input_token_details)),a.output_token_details&&e.setAttribute(ki,JSON.stringify(a.output_token_details))}}e.setAttribute(bi,JSON.stringify(r))}catch(r){console.debug(`Failed to process outputs for run ${t.id}`,r)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;const r=Object.keys(e);for(const i of r){const o=e[i];if(!(!o||typeof o!="object")&&(t=this.extractUnifiedRunTokens(o.usage_metadata),t||o.lc===1&&o.kwargs&&typeof o.kwargs=="object"&&(t=this.extractUnifiedRunTokens(o.kwargs.usage_metadata),t)))return t}const s=e.generations||[];if(!Array.isArray(s))return null;const a=Array.isArray(s[0])?s.flat():s;for(const i of a)if(typeof i=="object"&&i.message&&typeof i.message=="object"&&i.message.kwargs&&typeof i.message.kwargs=="object"&&(t=this.extractUnifiedRunTokens(i.message.kwargs.usage_metadata),t))return t;return null}extractUnifiedRunTokens(e){return!e||typeof e!="object"||typeof e.input_tokens!="number"||typeof e.output_tokens!="number"?null:[e.input_tokens,e.output_tokens]}}var Ve={},Nt={exports:{}},An;function io(){return An||(An=1,(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(c,u,l){this.fn=c,this.context=u,this.once=l||!1}function a(c,u,l,d,f){if(typeof l!="function")throw new TypeError("The listener must be a function");var p=new s(l,d||c,f),h=t?t+u:u;return c._events[h]?c._events[h].fn?c._events[h]=[c._events[h],p]:c._events[h].push(p):(c._events[h]=p,c._eventsCount++),c}function i(c,u){--c._eventsCount===0?c._events=new r:delete c._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],l,d;if(this._eventsCount===0)return u;for(d in l=this._events)e.call(l,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},o.prototype.listeners=function(u){var l=t?t+u:u,d=this._events[l];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,p=d.length,h=new Array(p);f<p;f++)h[f]=d[f].fn;return h},o.prototype.listenerCount=function(u){var l=t?t+u:u,d=this._events[l];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,l,d,f,p,h){var m=t?t+u:u;if(!this._events[m])return!1;var g=this._events[m],_=arguments.length,b,y;if(g.fn){switch(g.once&&this.removeListener(u,g.fn,void 0,!0),_){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,l),!0;case 3:return g.fn.call(g.context,l,d),!0;case 4:return g.fn.call(g.context,l,d,f),!0;case 5:return g.fn.call(g.context,l,d,f,p),!0;case 6:return g.fn.call(g.context,l,d,f,p,h),!0}for(y=1,b=new Array(_-1);y<_;y++)b[y-1]=arguments[y];g.fn.apply(g.context,b)}else{var N=g.length,R;for(y=0;y<N;y++)switch(g[y].once&&this.removeListener(u,g[y].fn,void 0,!0),_){case 1:g[y].fn.call(g[y].context);break;case 2:g[y].fn.call(g[y].context,l);break;case 3:g[y].fn.call(g[y].context,l,d);break;case 4:g[y].fn.call(g[y].context,l,d,f);break;default:if(!b)for(R=1,b=new Array(_-1);R<_;R++)b[R-1]=arguments[R];g[y].fn.apply(g[y].context,b)}}return!0},o.prototype.on=function(u,l,d){return a(this,u,l,d,!1)},o.prototype.once=function(u,l,d){return a(this,u,l,d,!0)},o.prototype.removeListener=function(u,l,d,f){var p=t?t+u:u;if(!this._events[p])return this;if(!l)return i(this,p),this;var h=this._events[p];if(h.fn)h.fn===l&&(!f||h.once)&&(!d||h.context===d)&&i(this,p);else{for(var m=0,g=[],_=h.length;m<_;m++)(h[m].fn!==l||f&&!h[m].once||d&&h[m].context!==d)&&g.push(h[m]);g.length?this._events[p]=g.length===1?g[0]:g:i(this,p)}return this},o.prototype.removeAllListeners=function(u){var l;return u?(l=t?t+u:u,this._events[l]&&i(this,l)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(Nt)),Nt.exports}var De={exports:{}},Ct,Rn;function oo(){return Rn||(Rn=1,Ct=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})))),Ct}var In;function co(){if(In)return De.exports;In=1;const n=oo();class e extends Error{constructor(s){super(s),this.name="TimeoutError"}}const t=(r,s,a)=>new Promise((i,o)=>{if(typeof s!="number"||s<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(s===1/0){i(r);return}const c=setTimeout(()=>{if(typeof a=="function"){try{i(a())}catch(d){o(d)}return}const u=typeof a=="string"?a:`Promise timed out after ${s} milliseconds`,l=a instanceof Error?a:new e(u);typeof r.cancel=="function"&&r.cancel(),o(l)},s);n(r.then(i,o),()=>{clearTimeout(c)})});return De.exports=t,De.exports.default=t,De.exports.TimeoutError=e,De.exports}var Je={},Ke={},kn;function uo(){if(kn)return Ke;kn=1,Object.defineProperty(Ke,"__esModule",{value:!0});function n(e,t,r){let s=0,a=e.length;for(;a>0;){const i=a/2|0;let o=s+i;r(e[o],t)<=0?(s=++o,a-=i+1):a=i}return s}return Ke.default=n,Ke}var $n;function lo(){if($n)return Je;$n=1,Object.defineProperty(Je,"__esModule",{value:!0});const n=uo();class e{constructor(){this._queue=[]}enqueue(r,s){s=Object.assign({priority:0},s);const a={priority:s.priority,run:r};if(this.size&&this._queue[this.size-1].priority>=s.priority){this._queue.push(a);return}const i=n.default(this._queue,a,(o,c)=>c.priority-o.priority);this._queue.splice(i,0,a)}dequeue(){const r=this._queue.shift();return r?.run}filter(r){return this._queue.filter(s=>s.priority===r.priority).map(s=>s.run)}get size(){return this._queue.length}}return Je.default=e,Je}var Pn;function fo(){if(Pn)return Ve;Pn=1,Object.defineProperty(Ve,"__esModule",{value:!0});const n=io(),e=co(),t=lo(),r=()=>{},s=new e.TimeoutError;class a extends n{constructor(o){var c,u,l,d;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=r,this._resolveIdle=r,o=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:t.default},o),!(typeof o.intervalCap=="number"&&o.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(u=(c=o.intervalCap)===null||c===void 0?void 0:c.toString())!==null&&u!==void 0?u:""}\` (${typeof o.intervalCap})`);if(o.interval===void 0||!(Number.isFinite(o.interval)&&o.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(d=(l=o.interval)===null||l===void 0?void 0:l.toString())!==null&&d!==void 0?d:""}\` (${typeof o.interval})`);this._carryoverConcurrencyCount=o.carryoverConcurrencyCount,this._isIntervalIgnored=o.intervalCap===1/0||o.interval===0,this._intervalCap=o.intervalCap,this._interval=o.interval,this._queue=new o.queueClass,this._queueClass=o.queueClass,this.concurrency=o.concurrency,this._timeout=o.timeout,this._throwOnTimeout=o.throwOnTimeout===!0,this._isPaused=o.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=r,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=r,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const o=Date.now();if(this._intervalId===void 0){const c=this._intervalEnd-o;if(c<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},c)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const o=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const c=this._queue.dequeue();return c?(this.emit("active"),c(),o&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(o){if(!(typeof o=="number"&&o>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${o}\` (${typeof o})`);this._concurrency=o,this._processQueue()}async add(o,c={}){return new Promise((u,l)=>{const d=async()=>{this._pendingCount++,this._intervalCount++;try{const f=this._timeout===void 0&&c.timeout===void 0?o():e.default(Promise.resolve(o()),c.timeout===void 0?this._timeout:c.timeout,()=>{(c.throwOnTimeout===void 0?this._throwOnTimeout:c.throwOnTimeout)&&l(s)});u(await f)}catch(f){l(f)}this._next()};this._queue.enqueue(d,c),this._tryToStartAnother(),this.emit("add")})}async addAll(o,c){return Promise.all(o.map(async u=>this.add(u,c)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(o=>{const c=this._resolveEmpty;this._resolveEmpty=()=>{c(),o()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(o=>{const c=this._resolveIdle;this._resolveIdle=()=>{c(),o()}})}get size(){return this._queue.size}sizeBy(o){return this._queue.filter(o).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(o){this._timeout=o}}return Ve.default=a,Ve}var ho=fo();const jt=ut(ho),po=[400,401,403,404,405,406,407,408],mo=[409];class Nn{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.debug=e.debug,"default"in jt?this.queue=new jt.default({concurrency:this.maxConcurrency}):this.queue=new jt({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){const r=this.onFailedResponseHook;return this.queue.add(()=>Va(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||s?.code==="ECONNABORTED")throw s;const a=s?.response,i=a?.status;if(i){if(po.includes(+i))throw s;if(mo.includes(+i))return;r&&await r(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,a)=>{e.signal?.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>j(this.debug)(...e).then(t=>t.ok?t:Promise.reject(t)))}}function Cn(n){return typeof n?._getType=="function"}function jn(n){const e={type:n._getType(),data:{content:n.content}};return n?.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}const go=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function q(n,e){if(!go.test(n)){const t=e!==void 0?`Invalid UUID for ${e}: ${n}`:`Invalid UUID: ${n}`;throw new Error(t)}return n}const Ln={};function Ks(n){Ln[n]||(console.warn(n),Ln[n]=!0)}var We={exports:{}},Lt,Un;function lt(){if(Un)return Lt;Un=1;const n="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,r=16,s=e-6;return Lt={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:s,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:n,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Lt}var Ut,Dn;function dt(){if(Dn)return Ut;Dn=1;var n={};return Ut=typeof process=="object"&&n&&n.NODE_DEBUG&&/\bsemver\b/i.test(n.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},Ut}var Mn;function Ze(){return Mn||(Mn=1,(function(n,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:s}=lt(),a=dt();e=n.exports={};const i=e.re=[],o=e.safeRe=[],c=e.src=[],u=e.safeSrc=[],l=e.t={};let d=0;const f="[a-zA-Z0-9-]",p=[["\\s",1],["\\d",s],[f,r]],h=g=>{for(const[_,b]of p)g=g.split(`${_}*`).join(`${_}{0,${b}}`).split(`${_}+`).join(`${_}{1,${b}}`);return g},m=(g,_,b)=>{const y=h(_),N=d++;a(g,N,_),l[g]=N,c[N]=_,u[N]=y,i[N]=new RegExp(_,b?"g":void 0),o[N]=new RegExp(y,b?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),m("MAINVERSION",`(${c[l.NUMERICIDENTIFIER]})\\.(${c[l.NUMERICIDENTIFIER]})\\.(${c[l.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${c[l.NUMERICIDENTIFIERLOOSE]})\\.(${c[l.NUMERICIDENTIFIERLOOSE]})\\.(${c[l.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${c[l.NONNUMERICIDENTIFIER]}|${c[l.NUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${c[l.NONNUMERICIDENTIFIER]}|${c[l.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASE",`(?:-(${c[l.PRERELEASEIDENTIFIER]}(?:\\.${c[l.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${c[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[l.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${f}+`),m("BUILD",`(?:\\+(${c[l.BUILDIDENTIFIER]}(?:\\.${c[l.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${c[l.MAINVERSION]}${c[l.PRERELEASE]}?${c[l.BUILD]}?`),m("FULL",`^${c[l.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${c[l.MAINVERSIONLOOSE]}${c[l.PRERELEASELOOSE]}?${c[l.BUILD]}?`),m("LOOSE",`^${c[l.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${c[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${c[l.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${c[l.XRANGEIDENTIFIER]})(?:\\.(${c[l.XRANGEIDENTIFIER]})(?:\\.(${c[l.XRANGEIDENTIFIER]})(?:${c[l.PRERELEASE]})?${c[l.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${c[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[l.XRANGEIDENTIFIERLOOSE]})(?:${c[l.PRERELEASELOOSE]})?${c[l.BUILD]}?)?)?`),m("XRANGE",`^${c[l.GTLT]}\\s*${c[l.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${c[l.GTLT]}\\s*${c[l.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),m("COERCE",`${c[l.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",c[l.COERCEPLAIN]+`(?:${c[l.PRERELEASE]})?(?:${c[l.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",c[l.COERCE],!0),m("COERCERTLFULL",c[l.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${c[l.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",m("TILDE",`^${c[l.LONETILDE]}${c[l.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${c[l.LONETILDE]}${c[l.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${c[l.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",m("CARET",`^${c[l.LONECARET]}${c[l.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${c[l.LONECARET]}${c[l.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${c[l.GTLT]}\\s*(${c[l.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${c[l.GTLT]}\\s*(${c[l.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${c[l.GTLT]}\\s*(${c[l.LOOSEPLAIN]}|${c[l.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${c[l.XRANGEPLAIN]})\\s+-\\s+(${c[l.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${c[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[l.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(We,We.exports)),We.exports}var Dt,qn;function Gr(){if(qn)return Dt;qn=1;const n=Object.freeze({loose:!0}),e=Object.freeze({});return Dt=r=>r?typeof r!="object"?n:r:e,Dt}var Mt,zn;function Ws(){if(zn)return Mt;zn=1;const n=/^[0-9]+$/,e=(r,s)=>{const a=n.test(r),i=n.test(s);return a&&i&&(r=+r,s=+s),r===s?0:a&&!i?-1:i&&!a?1:r<s?-1:1};return Mt={compareIdentifiers:e,rcompareIdentifiers:(r,s)=>e(s,r)},Mt}var qt,Fn;function se(){if(Fn)return qt;Fn=1;const n=dt(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=lt(),{safeRe:r,t:s}=Ze(),a=Gr(),{compareIdentifiers:i}=Ws();class o{constructor(u,l){if(l=a(l),u instanceof o){if(u.loose===!!l.loose&&u.includePrerelease===!!l.includePrerelease)return u;u=u.version}else if(typeof u!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof u}".`);if(u.length>e)throw new TypeError(`version is longer than ${e} characters`);n("SemVer",u,l),this.options=l,this.loose=!!l.loose,this.includePrerelease=!!l.includePrerelease;const d=u.trim().match(l.loose?r[s.LOOSE]:r[s.FULL]);if(!d)throw new TypeError(`Invalid Version: ${u}`);if(this.raw=u,this.major=+d[1],this.minor=+d[2],this.patch=+d[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");d[4]?this.prerelease=d[4].split(".").map(f=>{if(/^[0-9]+$/.test(f)){const p=+f;if(p>=0&&p<t)return p}return f}):this.prerelease=[],this.build=d[5]?d[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(u){if(n("SemVer.compare",this.version,this.options,u),!(u instanceof o)){if(typeof u=="string"&&u===this.version)return 0;u=new o(u,this.options)}return u.version===this.version?0:this.compareMain(u)||this.comparePre(u)}compareMain(u){return u instanceof o||(u=new o(u,this.options)),i(this.major,u.major)||i(this.minor,u.minor)||i(this.patch,u.patch)}comparePre(u){if(u instanceof o||(u=new o(u,this.options)),this.prerelease.length&&!u.prerelease.length)return-1;if(!this.prerelease.length&&u.prerelease.length)return 1;if(!this.prerelease.length&&!u.prerelease.length)return 0;let l=0;do{const d=this.prerelease[l],f=u.prerelease[l];if(n("prerelease compare",l,d,f),d===void 0&&f===void 0)return 0;if(f===void 0)return 1;if(d===void 0)return-1;if(d===f)continue;return i(d,f)}while(++l)}compareBuild(u){u instanceof o||(u=new o(u,this.options));let l=0;do{const d=this.build[l],f=u.build[l];if(n("build compare",l,d,f),d===void 0&&f===void 0)return 0;if(f===void 0)return 1;if(d===void 0)return-1;if(d===f)continue;return i(d,f)}while(++l)}inc(u,l,d){if(u.startsWith("pre")){if(!l&&d===!1)throw new Error("invalid increment argument: identifier is empty");if(l){const f=`-${l}`.match(this.options.loose?r[s.PRERELEASELOOSE]:r[s.PRERELEASE]);if(!f||f[1]!==l)throw new Error(`invalid identifier: ${l}`)}}switch(u){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",l,d);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",l,d);break;case"prepatch":this.prerelease.length=0,this.inc("patch",l,d),this.inc("pre",l,d);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",l,d),this.inc("pre",l,d);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const f=Number(d)?1:0;if(this.prerelease.length===0)this.prerelease=[f];else{let p=this.prerelease.length;for(;--p>=0;)typeof this.prerelease[p]=="number"&&(this.prerelease[p]++,p=-2);if(p===-1){if(l===this.prerelease.join(".")&&d===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(f)}}if(l){let p=[l,f];d===!1&&(p=[l]),i(this.prerelease[0],l)===0?isNaN(this.prerelease[1])&&(this.prerelease=p):this.prerelease=p}break}default:throw new Error(`invalid increment argument: ${u}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return qt=o,qt}var zt,Gn;function je(){if(Gn)return zt;Gn=1;const n=se();return zt=(t,r,s=!1)=>{if(t instanceof n)return t;try{return new n(t,r)}catch(a){if(!s)return null;throw a}},zt}var Ft,Zn;function _o(){if(Zn)return Ft;Zn=1;const n=je();return Ft=(t,r)=>{const s=n(t,r);return s?s.version:null},Ft}var Gt,Bn;function yo(){if(Bn)return Gt;Bn=1;const n=je();return Gt=(t,r)=>{const s=n(t.trim().replace(/^[=v]+/,""),r);return s?s.version:null},Gt}var Zt,Hn;function vo(){if(Hn)return Zt;Hn=1;const n=se();return Zt=(t,r,s,a,i)=>{typeof s=="string"&&(i=a,a=s,s=void 0);try{return new n(t instanceof n?t.version:t,s).inc(r,a,i).version}catch{return null}},Zt}var Bt,Vn;function bo(){if(Vn)return Bt;Vn=1;const n=je();return Bt=(t,r)=>{const s=n(t,null,!0),a=n(r,null,!0),i=s.compare(a);if(i===0)return null;const o=i>0,c=o?s:a,u=o?a:s,l=!!c.prerelease.length;if(!!u.prerelease.length&&!l){if(!u.patch&&!u.minor)return"major";if(u.compareMain(c)===0)return u.minor&&!u.patch?"minor":"patch"}const f=l?"pre":"";return s.major!==a.major?f+"major":s.minor!==a.minor?f+"minor":s.patch!==a.patch?f+"patch":"prerelease"},Bt}var Ht,Jn;function wo(){if(Jn)return Ht;Jn=1;const n=se();return Ht=(t,r)=>new n(t,r).major,Ht}var Vt,Kn;function Eo(){if(Kn)return Vt;Kn=1;const n=se();return Vt=(t,r)=>new n(t,r).minor,Vt}var Jt,Wn;function So(){if(Wn)return Jt;Wn=1;const n=se();return Jt=(t,r)=>new n(t,r).patch,Jt}var Kt,Xn;function To(){if(Xn)return Kt;Xn=1;const n=je();return Kt=(t,r)=>{const s=n(t,r);return s&&s.prerelease.length?s.prerelease:null},Kt}var Wt,Qn;function pe(){if(Qn)return Wt;Qn=1;const n=se();return Wt=(t,r,s)=>new n(t,s).compare(new n(r,s)),Wt}var Xt,Yn;function Oo(){if(Yn)return Xt;Yn=1;const n=pe();return Xt=(t,r,s)=>n(r,t,s),Xt}var Qt,es;function xo(){if(es)return Qt;es=1;const n=pe();return Qt=(t,r)=>n(t,r,!0),Qt}var Yt,ts;function Zr(){if(ts)return Yt;ts=1;const n=se();return Yt=(t,r,s)=>{const a=new n(t,s),i=new n(r,s);return a.compare(i)||a.compareBuild(i)},Yt}var er,rs;function Ao(){if(rs)return er;rs=1;const n=Zr();return er=(t,r)=>t.sort((s,a)=>n(s,a,r)),er}var tr,ns;function Ro(){if(ns)return tr;ns=1;const n=Zr();return tr=(t,r)=>t.sort((s,a)=>n(a,s,r)),tr}var rr,ss;function ft(){if(ss)return rr;ss=1;const n=pe();return rr=(t,r,s)=>n(t,r,s)>0,rr}var nr,as;function Br(){if(as)return nr;as=1;const n=pe();return nr=(t,r,s)=>n(t,r,s)<0,nr}var sr,is;function Xs(){if(is)return sr;is=1;const n=pe();return sr=(t,r,s)=>n(t,r,s)===0,sr}var ar,os;function Qs(){if(os)return ar;os=1;const n=pe();return ar=(t,r,s)=>n(t,r,s)!==0,ar}var ir,cs;function Hr(){if(cs)return ir;cs=1;const n=pe();return ir=(t,r,s)=>n(t,r,s)>=0,ir}var or,us;function Vr(){if(us)return or;us=1;const n=pe();return or=(t,r,s)=>n(t,r,s)<=0,or}var cr,ls;function Ys(){if(ls)return cr;ls=1;const n=Xs(),e=Qs(),t=ft(),r=Hr(),s=Br(),a=Vr();return cr=(o,c,u,l)=>{switch(c){case"===":return typeof o=="object"&&(o=o.version),typeof u=="object"&&(u=u.version),o===u;case"!==":return typeof o=="object"&&(o=o.version),typeof u=="object"&&(u=u.version),o!==u;case"":case"=":case"==":return n(o,u,l);case"!=":return e(o,u,l);case">":return t(o,u,l);case">=":return r(o,u,l);case"<":return s(o,u,l);case"<=":return a(o,u,l);default:throw new TypeError(`Invalid operator: ${c}`)}},cr}var ur,ds;function Io(){if(ds)return ur;ds=1;const n=se(),e=je(),{safeRe:t,t:r}=Ze();return ur=(a,i)=>{if(a instanceof n)return a;if(typeof a=="number"&&(a=String(a)),typeof a!="string")return null;i=i||{};let o=null;if(!i.rtl)o=a.match(i.includePrerelease?t[r.COERCEFULL]:t[r.COERCE]);else{const p=i.includePrerelease?t[r.COERCERTLFULL]:t[r.COERCERTL];let h;for(;(h=p.exec(a))&&(!o||o.index+o[0].length!==a.length);)(!o||h.index+h[0].length!==o.index+o[0].length)&&(o=h),p.lastIndex=h.index+h[1].length+h[2].length;p.lastIndex=-1}if(o===null)return null;const c=o[2],u=o[3]||"0",l=o[4]||"0",d=i.includePrerelease&&o[5]?`-${o[5]}`:"",f=i.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${c}.${u}.${l}${d}${f}`,i)},ur}var lr,fs;function ko(){if(fs)return lr;fs=1;class n{constructor(){this.max=1e3,this.map=new Map}get(t){const r=this.map.get(t);if(r!==void 0)return this.map.delete(t),this.map.set(t,r),r}delete(t){return this.map.delete(t)}set(t,r){if(!this.delete(t)&&r!==void 0){if(this.map.size>=this.max){const a=this.map.keys().next().value;this.delete(a)}this.map.set(t,r)}return this}}return lr=n,lr}var dr,hs;function me(){if(hs)return dr;hs=1;const n=/\s+/g;class e{constructor(O,v){if(v=s(v),O instanceof e)return O.loose===!!v.loose&&O.includePrerelease===!!v.includePrerelease?O:new e(O.raw,v);if(O instanceof a)return this.raw=O.value,this.set=[[O]],this.formatted=void 0,this;if(this.options=v,this.loose=!!v.loose,this.includePrerelease=!!v.includePrerelease,this.raw=O.trim().replace(n," "),this.set=this.raw.split("||").map(w=>this.parseRange(w.trim())).filter(w=>w.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const w=this.set[0];if(this.set=this.set.filter(E=>!m(E[0])),this.set.length===0)this.set=[w];else if(this.set.length>1){for(const E of this.set)if(E.length===1&&g(E[0])){this.set=[E];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let O=0;O<this.set.length;O++){O>0&&(this.formatted+="||");const v=this.set[O];for(let w=0;w<v.length;w++)w>0&&(this.formatted+=" "),this.formatted+=v[w].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(O){const w=((this.options.includePrerelease&&p)|(this.options.loose&&h))+":"+O,E=r.get(w);if(E)return E;const x=this.options.loose,P=x?c[u.HYPHENRANGELOOSE]:c[u.HYPHENRANGE];O=O.replace(P,re(this.options.includePrerelease)),i("hyphen replace",O),O=O.replace(c[u.COMPARATORTRIM],l),i("comparator trim",O),O=O.replace(c[u.TILDETRIM],d),i("tilde trim",O),O=O.replace(c[u.CARETTRIM],f),i("caret trim",O);let G=O.split(" ").map(K=>b(K,this.options)).join(" ").split(/\s+/).map(K=>ae(K,this.options));x&&(G=G.filter(K=>(i("loose invalid filter",K,this.options),!!K.match(c[u.COMPARATORLOOSE])))),i("range list",G);const D=new Map,V=G.map(K=>new a(K,this.options));for(const K of V){if(m(K))return[K];D.set(K.value,K)}D.size>1&&D.has("")&&D.delete("");const W=[...D.values()];return r.set(w,W),W}intersects(O,v){if(!(O instanceof e))throw new TypeError("a Range is required");return this.set.some(w=>_(w,v)&&O.set.some(E=>_(E,v)&&w.every(x=>E.every(P=>x.intersects(P,v)))))}test(O){if(!O)return!1;if(typeof O=="string")try{O=new o(O,this.options)}catch{return!1}for(let v=0;v<this.set.length;v++)if(Ae(this.set[v],O,this.options))return!0;return!1}}dr=e;const t=ko(),r=new t,s=Gr(),a=ht(),i=dt(),o=se(),{safeRe:c,t:u,comparatorTrimReplace:l,tildeTrimReplace:d,caretTrimReplace:f}=Ze(),{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:h}=lt(),m=I=>I.value==="<0.0.0-0",g=I=>I.value==="",_=(I,O)=>{let v=!0;const w=I.slice();let E=w.pop();for(;v&&w.length;)v=w.every(x=>E.intersects(x,O)),E=w.pop();return v},b=(I,O)=>(i("comp",I,O),I=L(I,O),i("caret",I),I=N(I,O),i("tildes",I),I=$(I,O),i("xrange",I),I=te(I,O),i("stars",I),I),y=I=>!I||I.toLowerCase()==="x"||I==="*",N=(I,O)=>I.trim().split(/\s+/).map(v=>R(v,O)).join(" "),R=(I,O)=>{const v=O.loose?c[u.TILDELOOSE]:c[u.TILDE];return I.replace(v,(w,E,x,P,G)=>{i("tilde",I,w,E,x,P,G);let D;return y(E)?D="":y(x)?D=`>=${E}.0.0 <${+E+1}.0.0-0`:y(P)?D=`>=${E}.${x}.0 <${E}.${+x+1}.0-0`:G?(i("replaceTilde pr",G),D=`>=${E}.${x}.${P}-${G} <${E}.${+x+1}.0-0`):D=`>=${E}.${x}.${P} <${E}.${+x+1}.0-0`,i("tilde return",D),D})},L=(I,O)=>I.trim().split(/\s+/).map(v=>M(v,O)).join(" "),M=(I,O)=>{i("caret",I,O);const v=O.loose?c[u.CARETLOOSE]:c[u.CARET],w=O.includePrerelease?"-0":"";return I.replace(v,(E,x,P,G,D)=>{i("caret",I,E,x,P,G,D);let V;return y(x)?V="":y(P)?V=`>=${x}.0.0${w} <${+x+1}.0.0-0`:y(G)?x==="0"?V=`>=${x}.${P}.0${w} <${x}.${+P+1}.0-0`:V=`>=${x}.${P}.0${w} <${+x+1}.0.0-0`:D?(i("replaceCaret pr",D),x==="0"?P==="0"?V=`>=${x}.${P}.${G}-${D} <${x}.${P}.${+G+1}-0`:V=`>=${x}.${P}.${G}-${D} <${x}.${+P+1}.0-0`:V=`>=${x}.${P}.${G}-${D} <${+x+1}.0.0-0`):(i("no pr"),x==="0"?P==="0"?V=`>=${x}.${P}.${G}${w} <${x}.${P}.${+G+1}-0`:V=`>=${x}.${P}.${G}${w} <${x}.${+P+1}.0-0`:V=`>=${x}.${P}.${G} <${+x+1}.0.0-0`),i("caret return",V),V})},$=(I,O)=>(i("replaceXRanges",I,O),I.split(/\s+/).map(v=>Y(v,O)).join(" ")),Y=(I,O)=>{I=I.trim();const v=O.loose?c[u.XRANGELOOSE]:c[u.XRANGE];return I.replace(v,(w,E,x,P,G,D)=>{i("xRange",I,w,E,x,P,G,D);const V=y(x),W=V||y(P),K=W||y(G),Le=K;return E==="="&&Le&&(E=""),D=O.includePrerelease?"-0":"",V?E===">"||E==="<"?w="<0.0.0-0":w="*":E&&Le?(W&&(P=0),G=0,E===">"?(E=">=",W?(x=+x+1,P=0,G=0):(P=+P+1,G=0)):E==="<="&&(E="<",W?x=+x+1:P=+P+1),E==="<"&&(D="-0"),w=`${E+x}.${P}.${G}${D}`):W?w=`>=${x}.0.0${D} <${+x+1}.0.0-0`:K&&(w=`>=${x}.${P}.0${D} <${x}.${+P+1}.0-0`),i("xRange return",w),w})},te=(I,O)=>(i("replaceStars",I,O),I.trim().replace(c[u.STAR],"")),ae=(I,O)=>(i("replaceGTE0",I,O),I.trim().replace(c[O.includePrerelease?u.GTE0PRE:u.GTE0],"")),re=I=>(O,v,w,E,x,P,G,D,V,W,K,Le)=>(y(w)?v="":y(E)?v=`>=${w}.0.0${I?"-0":""}`:y(x)?v=`>=${w}.${E}.0${I?"-0":""}`:P?v=`>=${v}`:v=`>=${v}${I?"-0":""}`,y(V)?D="":y(W)?D=`<${+V+1}.0.0-0`:y(K)?D=`<${V}.${+W+1}.0-0`:Le?D=`<=${V}.${W}.${K}-${Le}`:I?D=`<${V}.${W}.${+K+1}-0`:D=`<=${D}`,`${v} ${D}`.trim()),Ae=(I,O,v)=>{for(let w=0;w<I.length;w++)if(!I[w].test(O))return!1;if(O.prerelease.length&&!v.includePrerelease){for(let w=0;w<I.length;w++)if(i(I[w].semver),I[w].semver!==a.ANY&&I[w].semver.prerelease.length>0){const E=I[w].semver;if(E.major===O.major&&E.minor===O.minor&&E.patch===O.patch)return!0}return!1}return!0};return dr}var fr,ps;function ht(){if(ps)return fr;ps=1;const n=Symbol("SemVer ANY");class e{static get ANY(){return n}constructor(l,d){if(d=t(d),l instanceof e){if(l.loose===!!d.loose)return l;l=l.value}l=l.trim().split(/\s+/).join(" "),i("comparator",l,d),this.options=d,this.loose=!!d.loose,this.parse(l),this.semver===n?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(l){const d=this.options.loose?r[s.COMPARATORLOOSE]:r[s.COMPARATOR],f=l.match(d);if(!f)throw new TypeError(`Invalid comparator: ${l}`);this.operator=f[1]!==void 0?f[1]:"",this.operator==="="&&(this.operator=""),f[2]?this.semver=new o(f[2],this.options.loose):this.semver=n}toString(){return this.value}test(l){if(i("Comparator.test",l,this.options.loose),this.semver===n||l===n)return!0;if(typeof l=="string")try{l=new o(l,this.options)}catch{return!1}return a(l,this.operator,this.semver,this.options)}intersects(l,d){if(!(l instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new c(l.value,d).test(this.value):l.operator===""?l.value===""?!0:new c(this.value,d).test(l.semver):(d=t(d),d.includePrerelease&&(this.value==="<0.0.0-0"||l.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||l.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&l.operator.startsWith(">")||this.operator.startsWith("<")&&l.operator.startsWith("<")||this.semver.version===l.semver.version&&this.operator.includes("=")&&l.operator.includes("=")||a(this.semver,"<",l.semver,d)&&this.operator.startsWith(">")&&l.operator.startsWith("<")||a(this.semver,">",l.semver,d)&&this.operator.startsWith("<")&&l.operator.startsWith(">")))}}fr=e;const t=Gr(),{safeRe:r,t:s}=Ze(),a=Ys(),i=dt(),o=se(),c=me();return fr}var hr,ms;function pt(){if(ms)return hr;ms=1;const n=me();return hr=(t,r,s)=>{try{r=new n(r,s)}catch{return!1}return r.test(t)},hr}var pr,gs;function $o(){if(gs)return pr;gs=1;const n=me();return pr=(t,r)=>new n(t,r).set.map(s=>s.map(a=>a.value).join(" ").trim().split(" ")),pr}var mr,_s;function Po(){if(_s)return mr;_s=1;const n=se(),e=me();return mr=(r,s,a)=>{let i=null,o=null,c=null;try{c=new e(s,a)}catch{return null}return r.forEach(u=>{c.test(u)&&(!i||o.compare(u)===-1)&&(i=u,o=new n(i,a))}),i},mr}var gr,ys;function No(){if(ys)return gr;ys=1;const n=se(),e=me();return gr=(r,s,a)=>{let i=null,o=null,c=null;try{c=new e(s,a)}catch{return null}return r.forEach(u=>{c.test(u)&&(!i||o.compare(u)===1)&&(i=u,o=new n(i,a))}),i},gr}var _r,vs;function Co(){if(vs)return _r;vs=1;const n=se(),e=me(),t=ft();return _r=(s,a)=>{s=new e(s,a);let i=new n("0.0.0");if(s.test(i)||(i=new n("0.0.0-0"),s.test(i)))return i;i=null;for(let o=0;o<s.set.length;++o){const c=s.set[o];let u=null;c.forEach(l=>{const d=new n(l.semver.version);switch(l.operator){case">":d.prerelease.length===0?d.patch++:d.prerelease.push(0),d.raw=d.format();case"":case">=":(!u||t(d,u))&&(u=d);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${l.operator}`)}}),u&&(!i||t(i,u))&&(i=u)}return i&&s.test(i)?i:null},_r}var yr,bs;function jo(){if(bs)return yr;bs=1;const n=me();return yr=(t,r)=>{try{return new n(t,r).range||"*"}catch{return null}},yr}var vr,ws;function Jr(){if(ws)return vr;ws=1;const n=se(),e=ht(),{ANY:t}=e,r=me(),s=pt(),a=ft(),i=Br(),o=Vr(),c=Hr();return vr=(l,d,f,p)=>{l=new n(l,p),d=new r(d,p);let h,m,g,_,b;switch(f){case">":h=a,m=o,g=i,_=">",b=">=";break;case"<":h=i,m=c,g=a,_="<",b="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(l,d,p))return!1;for(let y=0;y<d.set.length;++y){const N=d.set[y];let R=null,L=null;if(N.forEach(M=>{M.semver===t&&(M=new e(">=0.0.0")),R=R||M,L=L||M,h(M.semver,R.semver,p)?R=M:g(M.semver,L.semver,p)&&(L=M)}),R.operator===_||R.operator===b||(!L.operator||L.operator===_)&&m(l,L.semver))return!1;if(L.operator===b&&g(l,L.semver))return!1}return!0},vr}var br,Es;function Lo(){if(Es)return br;Es=1;const n=Jr();return br=(t,r,s)=>n(t,r,">",s),br}var wr,Ss;function Uo(){if(Ss)return wr;Ss=1;const n=Jr();return wr=(t,r,s)=>n(t,r,"<",s),wr}var Er,Ts;function Do(){if(Ts)return Er;Ts=1;const n=me();return Er=(t,r,s)=>(t=new n(t,s),r=new n(r,s),t.intersects(r,s)),Er}var Sr,Os;function Mo(){if(Os)return Sr;Os=1;const n=pt(),e=pe();return Sr=(t,r,s)=>{const a=[];let i=null,o=null;const c=t.sort((f,p)=>e(f,p,s));for(const f of c)n(f,r,s)?(o=f,i||(i=f)):(o&&a.push([i,o]),o=null,i=null);i&&a.push([i,null]);const u=[];for(const[f,p]of a)f===p?u.push(f):!p&&f===c[0]?u.push("*"):p?f===c[0]?u.push(`<=${p}`):u.push(`${f} - ${p}`):u.push(`>=${f}`);const l=u.join(" || "),d=typeof r.raw=="string"?r.raw:String(r);return l.length<d.length?l:r},Sr}var Tr,xs;function qo(){if(xs)return Tr;xs=1;const n=me(),e=ht(),{ANY:t}=e,r=pt(),s=pe(),a=(d,f,p={})=>{if(d===f)return!0;d=new n(d,p),f=new n(f,p);let h=!1;e:for(const m of d.set){for(const g of f.set){const _=c(m,g,p);if(h=h||_!==null,_)continue e}if(h)return!1}return!0},i=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],c=(d,f,p)=>{if(d===f)return!0;if(d.length===1&&d[0].semver===t){if(f.length===1&&f[0].semver===t)return!0;p.includePrerelease?d=i:d=o}if(f.length===1&&f[0].semver===t){if(p.includePrerelease)return!0;f=o}const h=new Set;let m,g;for(const $ of d)$.operator===">"||$.operator===">="?m=u(m,$,p):$.operator==="<"||$.operator==="<="?g=l(g,$,p):h.add($.semver);if(h.size>1)return null;let _;if(m&&g){if(_=s(m.semver,g.semver,p),_>0)return null;if(_===0&&(m.operator!==">="||g.operator!=="<="))return null}for(const $ of h){if(m&&!r($,String(m),p)||g&&!r($,String(g),p))return null;for(const Y of f)if(!r($,String(Y),p))return!1;return!0}let b,y,N,R,L=g&&!p.includePrerelease&&g.semver.prerelease.length?g.semver:!1,M=m&&!p.includePrerelease&&m.semver.prerelease.length?m.semver:!1;L&&L.prerelease.length===1&&g.operator==="<"&&L.prerelease[0]===0&&(L=!1);for(const $ of f){if(R=R||$.operator===">"||$.operator===">=",N=N||$.operator==="<"||$.operator==="<=",m){if(M&&$.semver.prerelease&&$.semver.prerelease.length&&$.semver.major===M.major&&$.semver.minor===M.minor&&$.semver.patch===M.patch&&(M=!1),$.operator===">"||$.operator===">="){if(b=u(m,$,p),b===$&&b!==m)return!1}else if(m.operator===">="&&!r(m.semver,String($),p))return!1}if(g){if(L&&$.semver.prerelease&&$.semver.prerelease.length&&$.semver.major===L.major&&$.semver.minor===L.minor&&$.semver.patch===L.patch&&(L=!1),$.operator==="<"||$.operator==="<="){if(y=l(g,$,p),y===$&&y!==g)return!1}else if(g.operator==="<="&&!r(g.semver,String($),p))return!1}if(!$.operator&&(g||m)&&_!==0)return!1}return!(m&&N&&!g&&_!==0||g&&R&&!m&&_!==0||M||L)},u=(d,f,p)=>{if(!d)return f;const h=s(d.semver,f.semver,p);return h>0?d:h<0||f.operator===">"&&d.operator===">="?f:d},l=(d,f,p)=>{if(!d)return f;const h=s(d.semver,f.semver,p);return h<0?d:h>0||f.operator==="<"&&d.operator==="<="?f:d};return Tr=a,Tr}var Or,As;function zo(){if(As)return Or;As=1;const n=Ze(),e=lt(),t=se(),r=Ws(),s=je(),a=_o(),i=yo(),o=vo(),c=bo(),u=wo(),l=Eo(),d=So(),f=To(),p=pe(),h=Oo(),m=xo(),g=Zr(),_=Ao(),b=Ro(),y=ft(),N=Br(),R=Xs(),L=Qs(),M=Hr(),$=Vr(),Y=Ys(),te=Io(),ae=ht(),re=me(),Ae=pt(),I=$o(),O=Po(),v=No(),w=Co(),E=jo(),x=Jr(),P=Lo(),G=Uo(),D=Do(),V=Mo(),W=qo();return Or={parse:s,valid:a,clean:i,inc:o,diff:c,major:u,minor:l,patch:d,prerelease:f,compare:p,rcompare:h,compareLoose:m,compareBuild:g,sort:_,rsort:b,gt:y,lt:N,eq:R,neq:L,gte:M,lte:$,cmp:Y,coerce:te,Comparator:ae,Range:re,satisfies:Ae,toComparators:I,maxSatisfying:O,minSatisfying:v,minVersion:w,validRange:E,outside:x,gtr:P,ltr:G,intersects:D,simplifyRange:V,subset:W,SemVer:t,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:r.compareIdentifiers,rcompareIdentifiers:r.rcompareIdentifiers},Or}zo();function be(n){if(!n||n.split("/").length>2||n.startsWith("/")||n.endsWith("/")||n.split(":").length>2)throw new Error(`Invalid identifier format: ${n}`);const[e,t]=n.split(":"),r=t||"latest";if(e.includes("/")){const[s,a]=e.split("/",2);if(!s||!a)throw new Error(`Invalid identifier format: ${n}`);return[s,a,r]}else{if(!e)throw new Error(`Invalid identifier format: ${n}`);return["-",e,r]}}class Fo extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function z(n,e,t){let r;if(n.ok){t&&(r=await n.text());return}r=await n.text();const s=`Failed to ${e}. Received status [${n.status}]: ${n.statusText}. Server response: ${r}`;if(n.status===409)throw new Fo(s);const a=new Error(s);throw a.status=n.status,a}const ea="ERR_CONFLICTING_ENDPOINTS";class Go extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:ea}),this.name="ConflictingEndpointsError"}}function Zo(n){return typeof n=="object"&&n!==null&&n.code===ea}var Rs="[...]",Bo={result:"[Circular]"},st=[],ke=[];const Ho=new TextEncoder;function Vo(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Xe(n){return Ho.encode(n)}function ta(n){if(n&&typeof n=="object"&&n!==null){if(n instanceof Map)return Object.fromEntries(n);if(n instanceof Set)return Array.from(n);if(n instanceof Date)return n.toISOString();if(n instanceof RegExp)return n.toString();if(n instanceof Error)return{name:n.name,message:n.message}}else if(typeof n=="bigint")return n.toString();return n}function Jo(n){return function(e,t){return ta(t)}}function ie(n,e,t,r,s){try{const a=JSON.stringify(n,Jo(t),r);return Xe(a)}catch(a){if(!a.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),Xe("[Unserializable]");oe("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof s>"u"&&(s=Vo()),Mr(n,"",0,[],void 0,0,s);let i;try{ke.length===0?i=JSON.stringify(n,t,r):i=JSON.stringify(n,Ko(t),r)}catch{return Xe("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;st.length!==0;){const o=st.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return Xe(i)}}function xr(n,e,t,r){var s=Object.getOwnPropertyDescriptor(r,t);s.get!==void 0?s.configurable?(Object.defineProperty(r,t,{value:n}),st.push([r,t,e,s])):ke.push([e,t,n]):(r[t]=n,st.push([r,t,e]))}function Mr(n,e,t,r,s,a,i){a+=1;var o;if(typeof n=="object"&&n!==null){for(o=0;o<r.length;o++)if(r[o]===n){xr(Bo,n,e,s);return}if(typeof i.depthLimit<"u"&&a>i.depthLimit){xr(Rs,n,e,s);return}if(typeof i.edgesLimit<"u"&&t+1>i.edgesLimit){xr(Rs,n,e,s);return}if(r.push(n),Array.isArray(n))for(o=0;o<n.length;o++)Mr(n[o],o,o,r,n,a,i);else{n=ta(n);var c=Object.keys(n);for(o=0;o<c.length;o++){var u=c[o];Mr(n[u],u,o,r,n,a,i)}}r.pop()}}function Ko(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if(ke.length>0)for(var r=0;r<ke.length;r++){var s=ke[r];if(s[1]===e&&s[0]===t){t=s[2],ke.splice(r,1);break}}return n.call(this,e,t)}}function Is(n){const e=Hs(),t=Hi(),r=n.extra??{},s=r.metadata;return n.extra={...r,runtime:{...e,...r?.runtime},metadata:{...t,...t.revision_id||"revision_id"in n&&n.revision_id?{revision_id:("revision_id"in n?n.revision_id:void 0)??t.revision_id}:{},...s}},n}const Wo=n=>{const e=n?.toString()??oe("TRACING_SAMPLING_RATE");if(e===void 0)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},Xo=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function Qo(n){const e=[];for await(const t of n)e.push(t);return e}function Ar(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const Yo=async n=>{if(n?.status===429){const e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function ks(n){return typeof n=="number"?Number(n.toFixed(4)):n}class ec{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const r=new Promise(a=>{t=a}),s=ie(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:r,size:s}),this.sizeBytes+=s,r}pop(e){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let r=0;for(;r+(this.peek()?.size??0)<e&&this.items.length>0;){const s=this.items.shift();s&&(t.push(s),r+=s.size,this.sizeBytes-=s.size)}if(t.length===0&&this.items.length>0){const s=this.items.shift();t.push(s),r+=s.size,this.sizeBytes-=s.size}return[t.map(s=>({action:s.action,item:s.payload,otelContext:s.otelContext,apiKey:s.apiKey,apiUrl:s.apiUrl})),()=>t.forEach(s=>s.itemPromiseResolve())]}}const tc=20971520,rc=2500,$s="https://api.smith.langchain.com";class at{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new ec}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:_e("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:_e("LANGSMITH_DEBUG")==="true"});const t=at.getDefaultClientConfig();if(this.tracingSampleRate=Wo(e.tracingSamplingRate),this.apiUrl=Ar(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=Ar(e.apiKey??t.apiKey),this.webUrl=Ar(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new Nn({...e.callerOptions??{},debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.batchIngestCaller=new Nn({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:Yo,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,Vs()&&(this.langSmithToOTELTranslator=new ao)}static getDefaultClientConfig(){const e=oe("API_KEY"),t=oe("ENDPOINT")??$s,r=oe("HIDE_INPUTS")==="true",s=oe("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:Xo(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${Zs}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}_getPlatformEndpointPath(e){return this.apiUrl.slice(-3)!=="/v1"&&this.apiUrl.slice(-4)!=="/v1/"?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=await this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){const r=t?.toString()??"",s=`${this.apiUrl}${e}?${r}`,a=await this.caller.call(j(this.debug),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(a,`Failed to fetch ${e}`),a}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,r){let s=Number(t.get("offset"))||0;const a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(a));const i=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(j(this.debug),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(o,`Failed to fetch ${e}`);const c=r?r(await o.json()):await o.json();if(c.length===0||(yield c,c.length<a))break;s+=c.length}}async*_getCursorPaginatedList(e,t=null,r="POST",s="runs"){const a=t?{...t}:{};for(;;){const o=await(await this.caller.call(j(this.debug),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)})).json();if(!o||!o[s])break;yield o[s];const c=o.cursors;if(!c||!c.next)break;a.cursor=c.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const r=[];for(const s of e)this.filteredPostUuids.has(s.trace_id)?s.id===s.trace_id&&this.filteredPostUuids.delete(s.trace_id):r.push(s);return r}else{const r=[];for(const s of e){const a=s.trace_id??s.id;this.filteredPostUuids.has(a)||(s.id===a?this._shouldSample()?r.push(s):this.filteredPostUuids.add(a):r.push(s))}return r}}async _getBatchSizeLimitBytes(){const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??tc}async _getMultiPartSupport(){return(await this._ensureServerInfo()).instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[r,s]=this.autoBatchQueue.pop(e);if(!r.length){s();break}const a=r.reduce((c,u)=>{const l=u.apiUrl??this.apiUrl,d=u.apiKey??this.apiKey,p=u.apiKey===this.apiKey&&u.apiUrl===this.apiUrl?"default":`${l}|${d}`;return c[p]||(c[p]=[]),c[p].push(u),c},{}),i=[];for(const[c,u]of Object.entries(a)){const l=this._processBatch(u,{apiUrl:c==="default"?void 0:c.split("|")[0],apiKey:c==="default"?void 0:c.split("|")[1]});i.push(l)}const o=Promise.all(i).finally(s);t.push(o)}return Promise.all(t)}async _processBatch(e,t){if(e.length)try{if(this.langSmithToOTELTranslator!==void 0)this._sendBatchToOTELTranslator(e);else{const r={runCreates:e.filter(a=>a.action==="create").map(a=>a.item),runUpdates:e.filter(a=>a.action==="update").map(a=>a.item)};(await this._ensureServerInfo())?.batch_ingest_config?.use_multipart_endpoint?await this.multipartIngestRuns(r,t):await this.batchIngestRuns(r,t)}}catch(r){console.error("Error exporting batch:",r)}}_sendBatchToOTELTranslator(e){if(this.langSmithToOTELTranslator!==void 0){const t=new Map,r=[];for(const s of e)s.item.id&&s.otelContext&&(t.set(s.item.id,s.otelContext),s.action==="create"?r.push({operation:"post",id:s.item.id,trace_id:s.item.trace_id??s.item.id,run:s.item}):r.push({operation:"patch",id:s.item.id,trace_id:s.item.trace_id??s.item.id,run:s.item}));this.langSmithToOTELTranslator.exportBatch(r,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=Is(e.item);const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const r=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>r&&this.drainAutoBatchQueue(r),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(r)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await this.caller.call(j(this.debug),`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(rc),...this.fetchOptions});await z(e,"get server info");const t=await e.json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(t,null,2)+`
`),t}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[WARNING]: LangSmith failed to fetch info on supported operations with status code ${e.status}. Falling back to batch operations and default limits.`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}_cloneCurrentOTELContext(){const e=Js(),t=to();if(this.langSmithToOTELTranslator!==void 0){const r=e.getActiveSpan();if(r)return e.setSpan(t.active(),r)}}async createRun(e,t){if(!this._filterForSampling([e]).length)return;const r={...this.headers,"Content-Type":"application/json"},s=e.project_name;delete e.project_name;const a=await this.prepareRunCreateOrUpdateInputs({session_name:s,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&a.trace_id!==void 0&&a.dotted_order!==void 0){const c=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:a,otelContext:c,apiKey:t?.apiKey,apiUrl:t?.apiUrl}).catch(console.error);return}const i=Is(a);t?.apiKey!==void 0&&(r["x-api-key"]=t.apiKey);const o=await this.caller.call(j(this.debug),`${t?.apiUrl??this.apiUrl}/runs`,{method:"POST",headers:r,body:ie(i,`Creating run with id: ${i.id}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(o,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t},r){if(e===void 0&&t===void 0)return;let s=await Promise.all(e?.map(c=>this.prepareRunCreateOrUpdateInputs(c))??[]),a=await Promise.all(t?.map(c=>this.prepareRunCreateOrUpdateInputs(c))??[]);if(s.length>0&&a.length>0){const c=s.reduce((l,d)=>(d.id&&(l[d.id]=d),l),{}),u=[];for(const l of a)l.id!==void 0&&c[l.id]?c[l.id]={...c[l.id],...l}:u.push(l);s=Object.values(c),a=u}const i={post:s,patch:a};if(!i.post.length&&!i.patch.length)return;const o={post:[],patch:[]};for(const c of["post","patch"]){const u=c,l=i[u].reverse();let d=l.pop();for(;d!==void 0;)o[u].push(d),d=l.pop()}if(o.post.length>0||o.patch.length>0){const c=o.post.map(u=>u.id).concat(o.patch.map(u=>u.id)).join(",");await this._postBatchIngestRuns(ie(o,`Ingesting runs with ids: ${c}`),r)}}async _postBatchIngestRuns(e,t){const r={...this.headers,"Content-Type":"application/json",Accept:"application/json"};t?.apiKey!==void 0&&(r["x-api-key"]=t.apiKey);const s=await this.batchIngestCaller.call(j(this.debug),`${t?.apiUrl??this.apiUrl}/runs/batch`,{method:"POST",headers:r,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(s,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t},r){if(e===void 0&&t===void 0)return;const s={};let a=[];for(const d of e??[]){const f=await this.prepareRunCreateOrUpdateInputs(d);f.id!==void 0&&f.attachments!==void 0&&(s[f.id]=f.attachments),delete f.attachments,a.push(f)}let i=[];for(const d of t??[])i.push(await this.prepareRunCreateOrUpdateInputs(d));if(a.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(i.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&i.length>0){const d=a.reduce((p,h)=>(h.id&&(p[h.id]=h),p),{}),f=[];for(const p of i)p.id!==void 0&&d[p.id]?d[p.id]={...d[p.id],...p}:f.push(p);a=Object.values(d),i=f}if(a.length===0&&i.length===0)return;const u=[],l=[];for(const[d,f]of[["post",a],["patch",i]])for(const p of f){const{inputs:h,outputs:m,events:g,extra:_,error:b,serialized:y,attachments:N,...R}=p,L={inputs:h,outputs:m,events:g,extra:_,error:b,serialized:y},M=ie(R,`Serializing for multipart ingestion of run with id: ${R.id}`);l.push({name:`${d}.${R.id}`,payload:new Blob([M],{type:`application/json; length=${M.length}`})});for(const[$,Y]of Object.entries(L)){if(Y===void 0)continue;const te=ie(Y,`Serializing ${$} for multipart ingestion of run with id: ${R.id}`);l.push({name:`${d}.${R.id}.${$}`,payload:new Blob([te],{type:`application/json; length=${te.length}`})})}if(R.id!==void 0){const $=s[R.id];if($){delete s[R.id];for(const[Y,te]of Object.entries($)){let ae,re;if(Array.isArray(te)?[ae,re]=te:(ae=te.mimeType,re=te.data),Y.includes(".")){console.warn(`Skipping attachment '${Y}' for run ${R.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}l.push({name:`attachment.${R.id}.${Y}`,payload:new Blob([re],{type:`${ae}; length=${re.byteLength}`})})}}}u.push(`trace=${R.trace_id},id=${R.id}`)}await this._sendMultipartRequest(l,u.join("; "),r)}async _createNodeFetchBody(e,t){const r=[];for(const i of e)r.push(new Blob([`--${t}\r
`])),r.push(new Blob([`Content-Disposition: form-data; name="${i.name}"\r
`,`Content-Type: ${i.payload.type}\r
\r
`])),r.push(i.payload),r.push(new Blob([`\r
`]));return r.push(new Blob([`--${t}--\r
`])),await new Blob(r).arrayBuffer()}async _createMultipartStream(e,t){const r=new TextEncoder;return new ReadableStream({async start(a){const i=async o=>{typeof o=="string"?a.enqueue(r.encode(o)):a.enqueue(o)};for(const o of e){await i(`--${t}\r
`),await i(`Content-Disposition: form-data; name="${o.name}"\r
`),await i(`Content-Type: ${o.payload.type}\r
\r
`);const u=o.payload.stream().getReader();try{let l;for(;!(l=await u.read()).done;)a.enqueue(l.value)}finally{u.releaseLock()}await i(`\r
`)}await i(`--${t}--\r
`),a.close()}})}async _sendMultipartRequest(e,t,r){const s="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),a=Mi(),i=()=>this._createNodeFetchBody(e,s),o=()=>this._createMultipartStream(e,s),c=async u=>{const l={...this.headers,"Content-Type":`multipart/form-data; boundary=${s}`};return r?.apiKey!==void 0&&(l["x-api-key"]=r.apiKey),this.batchIngestCaller.call(j(this.debug),`${r?.apiUrl??this.apiUrl}/runs/multipart`,{method:"POST",headers:l,body:u,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})};try{let u,l=!1;!a&&!this.multipartStreamingDisabled?(l=!0,u=await c(await o())):u=await c(await i()),(!this.multipartStreamingDisabled||l)&&u.status===422&&(r?.apiUrl??this.apiUrl)!==$s&&(console.warn(`Streaming multipart upload to ${r?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,u=await c(await i())),await z(u,"ingest multipart runs",!0)}catch(u){console.warn(`${u.message.trim()}

Context: ${t}`)}}async updateRun(e,t,r){q(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));const s={...t,id:e};if(!this._filterForSampling([s],!0).length)return;if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){const o=this._cloneCurrentOTELContext();if(t.end_time!==void 0&&s.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:s,otelContext:o,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error);return}else this.processRunOperation({action:"update",item:s,otelContext:o,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error);return}const a={...this.headers,"Content-Type":"application/json"};r?.apiKey!==void 0&&(a["x-api-key"]=r.apiKey);const i=await this.caller.call(j(this.debug),`${r?.apiUrl??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,body:ie(t,`Serializing payload to update run with id: ${e}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(i,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){q(e);let r=await this._get(`/runs/${e}`);return t&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let s;t.session_id?s=t.session_id:r?.projectName?s=(await this.readProject({projectName:r?.projectName})).id:r?.projectId?s=r?.projectId:s=(await this.readProject({projectName:oe("PROJECT")||"default"})).id;const a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await Qo(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),r={},s={};t.sort((a,i)=>(a?.dotted_order??"").localeCompare(i?.dotted_order??""));for(const a of t){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);a.dotted_order?.startsWith(e.dotted_order??"")&&a.id!==e.id&&(a.parent_run_id in r||(r[a.parent_run_id]=[]),r[a.parent_run_id].push(a),s[a.id]=a)}e.child_runs=r[e.id]||[];for(const a in r)a!==e.id&&(s[a].child_runs=r[a]);return e}async*listRuns(e){const{projectId:t,projectName:r,parentRunId:s,traceId:a,referenceExampleId:i,startTime:o,executionOrder:c,isRoot:u,runType:l,error:d,id:f,query:p,filter:h,traceFilter:m,treeFilter:g,limit:_,select:b,order:y}=e;let N=[];if(t&&(N=Array.isArray(t)?t:[t]),r){const $=Array.isArray(r)?r:[r],Y=await Promise.all($.map(te=>this.readProject({projectName:te}).then(ae=>ae.id)));N.push(...Y)}const R=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],L={session:N.length?N:null,run_type:l,reference_example:i,query:p,filter:h,trace_filter:m,tree_filter:g,execution_order:c,parent_run:s,start_time:o?o.toISOString():null,error:d,id:f,limit:_,trace:a,select:b||R,is_root:u,order:y};let M=0;for await(const $ of this._getCursorPaginatedList("/runs/query",L))if(_){if(M>=_)break;if($.length+M>_){yield*$.slice(0,_-M);break}M+=$.length,yield*$}else yield*$}async*listGroupRuns(e){const{projectId:t,projectName:r,groupBy:s,filter:a,startTime:i,endTime:o,limit:c,offset:u}=e,d={session_id:t||(await this.readProject({projectName:r})).id,group_by:s,filter:a,start_time:i?i.toISOString():null,end_time:o?o.toISOString():null,limit:Number(c)||100};let f=Number(u)||0;const p="/runs/group",h=`${this.apiUrl}${p}`;for(;;){const m={...d,offset:f},g=Object.fromEntries(Object.entries(m).filter(([R,L])=>L!==void 0)),_=await this.caller.call(j(),h,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(g),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(_,`Failed to fetch ${p}`);const b=await _.json(),{groups:y,total:N}=b;if(y.length===0)break;for(const R of y)yield R;if(f+=y.length,f>=N)break}}async getRunStats({id:e,trace:t,parentRun:r,runType:s,projectNames:a,projectIds:i,referenceExampleIds:o,startTime:c,endTime:u,error:l,query:d,filter:f,traceFilter:p,treeFilter:h,isRoot:m,dataSourceType:g}){let _=i||[];a&&(_=[...i||[],...await Promise.all(a.map(L=>this.readProject({projectName:L}).then(M=>M.id)))]);const y=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:s,session:_,reference_example:o,start_time:c,end_time:u,error:l,query:d,filter:f,trace_filter:p,tree_filter:h,is_root:m,data_source_type:g}).filter(([L,M])=>M!==void 0));return await(await this.caller.call(j(this.debug),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||Ie()};q(e);const a=await(await this.caller.call(j(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){q(e);const t=await this.caller.call(j(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(t,"unshare run",!0)}async readRunSharedLink(e){q(e);const r=await(await this.caller.call(j(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(t!==void 0)for(const i of t)r.append("id",i);return q(e),await(await this.caller.call(j(this.debug),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),q(e);const s=await(await this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};q(e);const a=await(await this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){q(e);const t=await this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(t,"unshare dataset",!0)}async readSharedDataset(e){return q(e),await(await this.caller.call(j(this.debug),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const r={};t?.exampleIds&&(r.id=t.exampleIds);const s=new URLSearchParams;Object.entries(r).forEach(([o,c])=>{Array.isArray(c)?c.forEach(u=>s.append(o,u)):s.append(o,c)});const a=await this.caller.call(j(this.debug),`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await a.json();if(!a.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${Array.isArray(i.detail)?i.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return i.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:s=!1,projectExtra:a=null,referenceDatasetId:i=null}){const o=s?"?upsert=true":"",c=`${this.apiUrl}/sessions${o}`,u=a||{};r&&(u.metadata=r);const l={name:e,extra:u,description:t};i!==null&&(l.reference_dataset_id=i);const d=await this.caller.call(j(this.debug),c,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(d,"create project"),await d.json()}async updateProject(e,{name:t=null,description:r=null,metadata:s=null,projectExtra:a=null,endTime:i=null}){const o=`${this.apiUrl}/sessions/${e}`;let c=a;s&&(c={...c||{},metadata:s});const u={name:t,extra:c,description:r,end_time:i?new Date(i).toISOString():null},l=await this.caller.call(j(this.debug),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(l,"update project"),await l.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)q(e),r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");const a=await this.caller.call(j(this.debug),`${this.apiUrl}${r}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const i=await a.json();return a.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let s="/sessions";const a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)q(e),s+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&a.append("include_stats",r.toString());const i=await this._get(s,a);let o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=i[0]}else o=i;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:s,referenceDatasetName:a,referenceFree:i,metadata:o}={}){const c=new URLSearchParams;if(e!==void 0)for(const u of e)c.append("id",u);if(t!==void 0&&c.append("name",t),r!==void 0&&c.append("name_contains",r),s!==void 0)c.append("reference_dataset",s);else if(a!==void 0){const u=await this.readDataset({datasetName:a});c.append("reference_dataset",u.id)}i!==void 0&&c.append("reference_free",i.toString()),o!==void 0&&c.append("metadata",JSON.stringify(o));for await(const u of this._getPaginated("/sessions",c))yield*u}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,q(r);const s=await this.caller.call(j(this.debug),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(s,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:s,description:a,dataType:i,name:o}){const c=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),r.forEach(f=>{u.append("input_keys",f)}),s.forEach(f=>{u.append("output_keys",f)}),a&&u.append("description",a),i&&u.append("data_type",i),o&&u.append("name",o);const l=await this.caller.call(j(this.debug),c,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(l,"upload CSV"),await l.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:s,outputsSchema:a,metadata:i}={}){const o={name:e,description:t,extra:i?{metadata:i}:void 0};r&&(o.data_type=r),s&&(o.inputs_schema_definition=s),a&&(o.outputs_schema_definition=a);const c=await this.caller.call(j(this.debug),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(c,"create dataset"),await c.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const s=new URLSearchParams({limit:"1"});if(e&&t)throw new Error("Must provide either datasetName or datasetId, not both");if(e)q(e),r+=`/${e}`;else if(t)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");const a=await this._get(r,s);let i;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=a[0]}else i=a;return i}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:s}){let a=e;if(a===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:t})).id);const i=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:s,datasetNameContains:a,metadata:i}={}){const o="/datasets",c=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(const u of r)c.append("id",u);s!==void 0&&c.append("name",s),a!==void 0&&c.append("name_contains",a),i!==void 0&&c.append("metadata",JSON.stringify(i));for await(const u of this._getPaginated(o,c))yield*u}async updateDataset(e){const{datasetId:t,datasetName:r,...s}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const a=t??(await this.readDataset({datasetName:r})).id;q(a);const i=await this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(i,"update dataset"),await i.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:r,asOf:s,tag:a}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:r})).id;q(i);const o=await this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${i}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)q(s),r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const a=await this.caller.call(j(this.debug),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(a,`delete ${r}`),await a.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:t})).id),q(s);const a={tag:r},i=await this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(i,"index dataset"),await i.json()}async similarExamples(e,t,r,{filter:s}={}){const a={limit:r,inputs:e};s!==void 0&&(a.filter=s),q(t);const i=await this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(i,"fetch similar examples"),(await i.json()).examples}async createExample(e,t,r){if(Ps(e)&&(t!==void 0||r!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let s=t?r?.datasetId:e.dataset_id;const a=t?r?.datasetName:e.dataset_name;if(s===void 0&&a===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&a!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:a})).id);const i=(t?r?.createdAt:e.created_at)||new Date;let o;Ps(e)?o=e:o={inputs:e,outputs:t,created_at:i?.toISOString(),id:r?.exampleId,metadata:r?.metadata,split:r?.split,source_run_id:r?.sourceRunId,use_source_run_io:r?.useSourceRunIO,use_source_run_attachments:r?.useSourceRunAttachments,attachments:r?.attachments};const c=await this._uploadExamplesMultipart(s,[o]);return await this.readExample(c.example_ids?.[0]??Ie())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const b=e;let y=b[0].dataset_id;const N=b[0].dataset_name;if(y===void 0&&N===void 0)throw new Error("Must provide either datasetName or datasetId");if(y!==void 0&&N!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");y===void 0&&(y=(await this.readDataset({datasetName:N})).id);const R=await this._uploadExamplesMultipart(y,b);return await Promise.all(R.example_ids.map(M=>this.readExample(M)))}const{inputs:t,outputs:r,metadata:s,splits:a,sourceRunIds:i,useSourceRunIOs:o,useSourceRunAttachments:c,attachments:u,exampleIds:l,datasetId:d,datasetName:f}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let p=d;const h=f;if(p===void 0&&h===void 0)throw new Error("Must provide either datasetName or datasetId");if(p!==void 0&&h!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");p===void 0&&(p=(await this.readDataset({datasetName:h})).id);const m=t.map((b,y)=>({dataset_id:p,inputs:b,outputs:r?.[y],metadata:s?.[y],split:a?.[y],id:l?.[y],attachments:u?.[y],source_run_id:i?.[y],use_source_run_io:o?.[y],use_source_run_attachments:c?.[y]})),g=await this._uploadExamplesMultipart(p,m);return await Promise.all(g.example_ids.map(b=>this.readExample(b)))}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const s=e.map(i=>Cn(i)?jn(i):i),a=Cn(t)?jn(t):t;return this.createExample({input:s},{output:a},r)}async readExample(e){q(e);const t=`/examples/${e}`,r=await this._get(t),{attachment_urls:s,...a}=r,i=a;return s&&(i.attachments=Object.entries(s).reduce((o,[c,u])=>(o[c.slice(11)]={presigned_url:u.presigned_url,mime_type:u.mime_type},o),{})),i}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:s,splits:a,inlineS3Urls:i,metadata:o,limit:c,offset:u,filter:l,includeAttachments:d}={}){let f;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)f=e;else if(t!==void 0)f=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const p=new URLSearchParams({dataset:f}),h=s?typeof s=="string"?s:s?.toISOString():void 0;h&&p.append("as_of",h);const m=i??!0;if(p.append("inline_s3_urls",m.toString()),r!==void 0)for(const _ of r)p.append("id",_);if(a!==void 0)for(const _ of a)p.append("splits",_);if(o!==void 0){const _=JSON.stringify(o);p.append("metadata",_)}c!==void 0&&p.append("limit",c.toString()),u!==void 0&&p.append("offset",u.toString()),l!==void 0&&p.append("filter",l),d===!0&&["attachment_urls","outputs","metadata"].forEach(_=>p.append("select",_));let g=0;for await(const _ of this._getPaginated("/examples",p)){for(const b of _){const{attachment_urls:y,...N}=b,R=N;y&&(R.attachments=Object.entries(y).reduce((L,[M,$])=>(L[M.slice(11)]={presigned_url:$.presigned_url,mime_type:$.mime_type||void 0},L),{})),yield R,g++}if(c!==void 0&&g>=c)break}}async deleteExample(e){q(e);const t=`/examples/${e}`,r=await this.caller.call(j(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(r,`delete ${t}`),await r.json()}async updateExample(e,t){let r;t?r=e:r=e.id,q(r);let s;t?s={id:r,...t}:s=e;let a;return s.dataset_id!==void 0?a=s.dataset_id:a=(await this.readExample(r)).dataset_id,this._updateExamplesMultipart(a,[s])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:r,tag:s}){let a;if(e?a=e:a=(await this.readDataset({datasetName:t})).id,q(a),r&&s||!r&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const i=new URLSearchParams;r!==void 0&&i.append("as_of",typeof r=="string"?r:r.toISOString()),s!==void 0&&i.append("tag",s);const o=await this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${a}/version?${i.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,q(s);const a=new URLSearchParams,i=r?typeof r=="string"?r:r?.toISOString():void 0;return i&&a.append("as_of",i),await this._get(`/datasets/${s}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:s,remove:a=!1}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:t})).id:i=e,q(i);const o={split_name:r,examples:s.map(u=>(q(u),u)),remove:a},c=await this.caller.call(j(this.debug),`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(c,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:s,referenceExample:a}={loadChildRuns:!1}){Ks("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(a=await this.readExample(i.reference_example_id));const o=await t.evaluateRun(i,a),[c,u]=await this._logEvaluationFeedback(o,i,r);return u[0]}async createFeedback(e,t,{score:r,value:s,correction:a,comment:i,sourceInfo:o,feedbackSourceType:c="api",sourceRunId:u,feedbackId:l,feedbackConfig:d,projectId:f,comparativeExperimentId:p}){if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");const h={type:c??"api",metadata:o??{}};u!==void 0&&h?.metadata!==void 0&&!h.metadata.__run&&(h.metadata.__run={run_id:u}),h?.metadata!==void 0&&h.metadata.__run?.run_id!==void 0&&q(h.metadata.__run.run_id);const m={id:l??Ie(),run_id:e,key:t,score:ks(r),value:s,correction:a,comment:i,feedback_source:h,comparative_experiment_id:p,feedbackConfig:d,session_id:f},g=`${this.apiUrl}/feedback`,_=await this.caller.call(j(this.debug),g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(_,"create feedback",!0),m}async updateFeedback(e,{score:t,value:r,correction:s,comment:a}){const i={};t!=null&&(i.score=ks(t)),r!=null&&(i.value=r),s!=null&&(i.correction=s),a!=null&&(i.comment=a),q(e);const o=await this.caller.call(j(this.debug),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(o,"update feedback",!0)}async readFeedback(e){q(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){q(e);const t=`/feedback/${e}`,r=await this.caller.call(j(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(r,`delete ${t}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(const a of t)s.append("key",a);if(r)for(const a of r)s.append("source",a);for await(const a of this._getPaginated("/feedback",s))yield*a}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:s}={}){const a={run_id:e,feedback_key:t,feedback_config:s};return r?typeof r=="string"?a.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(a.expires_in=r):a.expires_in={hours:3},await(await this.caller.call(j(this.debug),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:s,description:a,metadata:i,id:o}){if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const c={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:a,created_at:(s??new Date)?.toISOString(),extra:{}};return i&&(c.extra.metadata=i),await(await this.caller.call(j(this.debug),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){q(e);const t=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",t))yield*r}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,r){const s=this._selectEvalResults(e),a=[];for(const i of s){let o=r||{};i.evaluatorInfo&&(o={...i.evaluatorInfo,...o});let c=null;i.targetRunId?c=i.targetRunId:t&&(c=t.id),a.push(await this.createFeedback(c,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[s,a]}async logEvaluationFeedback(e,t,r){const[s]=await this._logEvaluationFeedback(e,t,r);return s}async*listAnnotationQueues(e={}){const{queueIds:t,name:r,nameContains:s,limit:a}=e,i=new URLSearchParams;t&&t.forEach((c,u)=>{q(c,`queueIds[${u}]`),i.append("ids",c)}),r&&i.append("name",r),s&&i.append("name_contains",s),i.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(const c of this._getPaginated("/annotation-queues",i))if(yield*c,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(e){const{name:t,description:r,queueId:s,rubricInstructions:a}=e,i={name:t,description:r,id:s||Ie(),rubric_instructions:a},o=await this.caller.call(j(this.debug),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(i).filter(([u,l])=>l!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(o,"create annotation queue"),await o.json()}async readAnnotationQueue(e){const t=await this.caller.call(j(this.debug),`${this.apiUrl}/annotation-queues/${q(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(t,"read annotation queue"),await t.json()}async updateAnnotationQueue(e,t){const{name:r,description:s,rubricInstructions:a}=t,i=await this.caller.call(j(this.debug),`${this.apiUrl}/annotation-queues/${q(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:s,rubric_instructions:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(i,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(j(this.debug),`${this.apiUrl}/annotation-queues/${q(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const r=await this.caller.call(j(this.debug),`${this.apiUrl}/annotation-queues/${q(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((s,a)=>q(s,`runIds[${a}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const r=`/annotation-queues/${q(e,"queueId")}/run`,s=await this.caller.call(j(this.debug),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(s,"get run from annotation queue"),await s.json()}async deleteRunFromAnnotationQueue(e,t){const r=await this.caller.call(j(this.debug),`${this.apiUrl}/annotation-queues/${q(e,"queueId")}/runs/${q(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(r,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(j(this.debug),`${this.apiUrl}/annotation-queues/${q(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(j(this.debug),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){const s=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),a=new Error(`Error ${t.status}: ${t.statusText}
${s}`);throw a.statusCode=t.status,a}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[r,s,a]=be(e),i=await this.caller.call(j(this.debug),`${this.apiUrl}/likes/${r}/${s}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(i,`${t?"like":"unlike"} prompt`),await i.json()}async _getPromptUrl(e){const[t,r,s]=be(e);if(await this._currentTenantIsOwner(t)){const a=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${r}/${s.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${a.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${r}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);for await(const r of this._getPaginated("/repos",t,s=>s.repos))yield*r}async getPrompt(e){const[t,r,s]=be(e),a=await this.caller.call(j(this.debug),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(a.status===404)return null;await z(a,"get prompt");const i=await a.json();return i.repo?i.repo:null}async createPrompt(e,t){const r=await this._getSettings();if(t?.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,a,i]=be(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:a,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic},c=await this.caller.call(j(this.debug),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(c,"create prompt");const{repo:u}=await c.json();return u}async createCommit(e,t,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[s,a,i]=be(e),o=r?.parentCommitHash==="latest"||!r?.parentCommitHash?await this._getLatestCommitHash(`${s}/${a}`):r?.parentCommitHash,c={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},u=await this.caller.call(j(this.debug),`${this.apiUrl}/commits/${s}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(u,"create commit");const l=await u.json();return this._getPromptUrl(`${s}/${a}${l.commit_hash?`:${l.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const r=new FormData;for(const o of t){const c=o.id,u={...o.metadata&&{metadata:o.metadata},...o.split&&{split:o.split}},l=ie(u,`Serializing body for example with id: ${c}`),d=new Blob([l],{type:"application/json"});if(r.append(c,d),o.inputs){const f=ie(o.inputs,`Serializing inputs for example with id: ${c}`),p=new Blob([f],{type:"application/json"});r.append(`${c}.inputs`,p)}if(o.outputs){const f=ie(o.outputs,`Serializing outputs whle updating example with id: ${c}`),p=new Blob([f],{type:"application/json"});r.append(`${c}.outputs`,p)}if(o.attachments)for(const[f,p]of Object.entries(o.attachments)){let h,m;Array.isArray(p)?[h,m]=p:(h=p.mimeType,m=p.data);const g=new Blob([m],{type:`${h}; length=${m.byteLength}`});r.append(`${c}.attachment.${f}`,g)}if(o.attachments_operations){const f=ie(o.attachments_operations,`Serializing attachments while updating example with id: ${c}`),p=new Blob([f],{type:"application/json"});r.append(`${c}.attachments_operations`,p)}}const s=e??t[0]?.dataset_id;return await(await this.caller.call(j(this.debug),`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${s}/examples`)}`,{method:"PATCH",headers:this.headers,body:r})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const r=new FormData;for(const i of t){const o=(i.id??Ie()).toString(),c={created_at:i.created_at,...i.metadata&&{metadata:i.metadata},...i.split&&{split:i.split},...i.source_run_id&&{source_run_id:i.source_run_id},...i.use_source_run_io&&{use_source_run_io:i.use_source_run_io},...i.use_source_run_attachments&&{use_source_run_attachments:i.use_source_run_attachments}},u=ie(c,`Serializing body for uploaded example with id: ${o}`),l=new Blob([u],{type:"application/json"});if(r.append(o,l),i.inputs){const d=ie(i.inputs,`Serializing inputs for uploaded example with id: ${o}`),f=new Blob([d],{type:"application/json"});r.append(`${o}.inputs`,f)}if(i.outputs){const d=ie(i.outputs,`Serializing outputs for uploaded example with id: ${o}`),f=new Blob([d],{type:"application/json"});r.append(`${o}.outputs`,f)}if(i.attachments)for(const[d,f]of Object.entries(i.attachments)){let p,h;Array.isArray(f)?[p,h]=f:(p=f.mimeType,h=f.data);const m=new Blob([h],{type:`${p}; length=${h.byteLength}`});r.append(`${o}.attachment.${d}`,m)}}const s=await this.caller.call(j(this.debug),`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,body:r});return await z(s,"upload examples"),await s.json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,s]=be(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const a={};if(t?.description!==void 0&&(a.description=t.description),t?.readme!==void 0&&(a.readme=t.readme),t?.tags!==void 0&&(a.tags=t.tags),t?.isPublic!==void 0&&(a.is_public=t.isPublic),t?.isArchived!==void 0&&(a.is_archived=t.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");const i=await this.caller.call(j(this.debug),`${this.apiUrl}/repos/${r}/${s}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(i,"update prompt"),i.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,r,s]=be(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(j(this.debug),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[r,s,a]=be(e),i=await this.caller.call(j(this.debug),`${this.apiUrl}/commits/${r}/${s}/${a}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(i,"pull prompt commit");const o=await i.json();return{owner:r,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const r=await this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(s=>s!=="object")&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:r=this.apiUrl,datasetName:s}=t,[a,i]=this.parseTokenOrUrl(e,r),o=new at({apiUrl:a,apiKey:"placeholder"}),c=await o.readSharedDataset(i),u=s||c.name;try{if(await this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}const l=await o.listSharedExamples(i),d=await this.createDataset(u,{description:c.description,dataType:c.data_type||"kv",inputsSchema:c.inputs_schema_definition??void 0,outputsSchema:c.outputs_schema_definition??void 0});try{await this.createExamples({inputs:l.map(f=>f.inputs),outputs:l.flatMap(f=>f.outputs?[f.outputs]:[]),datasetId:d.id})}catch(f){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),f}}parseTokenOrUrl(e,t,r=2,s="dataset"){try{return q(e),[t,e]}catch{}try{const i=new URL(e).pathname.split("/").filter(o=>o!=="");if(i.length>=r){const o=i[i.length-r];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()]),this.langSmithToOTELTranslator!==void 0&&await ro()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush()}}function Ps(n){return"dataset_id"in n||"dataset_name"in n}const nc=n=>!!["TRACING_V2","TRACING"].find(t=>oe(t)==="true"),Rr=Symbol.for("lc:context_variables");function sc(n){return n.replace(/[-:.]/g,"")}function ac(n,e,t=1){const r=t.toFixed(0).slice(0,3).padStart(3,"0"),s=`${new Date(n).toISOString().slice(0,-1)}${r}Z`;return{dottedOrder:sc(s)+e,microsecondPrecisionDatestring:s}}class it{constructor(e,t,r,s){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=r,this.replicas=s}static fromHeader(e){const t=e.split(",");let r={},s=[],a,i;for(const o of t){const[c,u]=o.split("="),l=decodeURIComponent(u);c==="langsmith-metadata"?r=JSON.parse(l):c==="langsmith-tags"?s=l.split(","):c==="langsmith-project"?a=l:c==="langsmith-replicas"&&(i=JSON.parse(l))}return new it(r,s,a,i)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class he{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),ic(e)){Object.assign(this,{...e});return}const t=he.getDefaultConfig(),{metadata:r,...s}=e,a=s.client??he.getSharedClient(),i={...r,...s?.extra?.metadata};if(s.extra={...s.extra,metadata:i},Object.assign(this,{...t,...s,client:a}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=dc(this.replicas),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){const{dottedOrder:o,microsecondPrecisionDatestring:c}=ac(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+o:this.dotted_order=o,this._serialized_start_time=c}}set metadata(e){this.extra={...this.extra,metadata:{...this.extra?.metadata,...e}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){return{id:Ie(),run_type:"chain",project_name:qi(),child_runs:[],api_url:_e("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:_e("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return he.sharedClient||(he.sharedClient=new at),he.sharedClient}createChild(e){const t=this.child_execution_order+1,r=new he({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});Rr in this&&(r[Rr]=this[Rr]);const s=Symbol.for("lc:child_config"),a=e.extra?.[s]??this.extra[s];if(cc(a)){const c={...a},u=oc(c.callbacks)?c.callbacks.copy?.():void 0;u&&(Object.assign(u,{_parentRunId:r.id}),u.handlers?.find(ra)?.updateFromRunTree?.(r),c.callbacks=u),r.extra[s]=c}const i=new Set;let o=this;for(;o!=null&&!i.has(o.id);)i.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(r),r}async end(e,t,r=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,t,r=!0){const s=e.extra??{};if(s?.runtime?.library===void 0&&(s.runtime||(s.runtime={}),t))for(const[o,c]of Object.entries(t))s.runtime[o]||(s.runtime[o]=c);let a,i;return r?(i=e.parent_run?.id??e.parent_run_id,a=[]):(a=e.child_runs.map(o=>this._convertToCreate(o,t,r)),i=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,r=!0){const s=this._convertToCreate(this,t,r);if(e===this.project_name)return s;const a=d=>bn(`${d}:${e}`,bn.DNS),i=a(s.id),o=s.trace_id?a(s.trace_id):void 0,c=s.parent_run_id?a(s.parent_run_id):void 0;let u;if(s.dotted_order){const d=uc(s.dotted_order),f=[];for(let h=0;h<d.length-1;h++){const[m,g]=d[h],_=a(g);f.push(m.toISOString().replace(/[-:]/g,"").replace(".","")+_)}const[p]=d[d.length-1];f.push(p.toISOString().replace(/[-:]/g,"").replace(".","")+i),u=f.join(".")}else u=void 0;return{...s,id:i,trace_id:o,parent_run_id:c,dotted_order:u,session_name:e}}async postRun(e=!0){try{const t=Hs();if(this.replicas&&this.replicas.length>0)for(const{projectName:r,apiKey:s,apiUrl:a}of this.replicas){const i=this._remapForProject(r??this.project_name,t,!0);await this.client.createRun(i,{apiKey:s,apiUrl:a})}else{const r=this._convertToCreate(this,t,e);await this.client.createRun(r)}if(!e){Ks("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const r of this.child_runs)await r.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){if(this.replicas&&this.replicas.length>0)for(const{projectName:e,apiKey:t,apiUrl:r,updates:s}of this.replicas){const a=this._remapForProject(e??this.project_name);await this.client.updateRun(a.id,{inputs:a.inputs,outputs:a.outputs,error:a.error,parent_run_id:a.parent_run_id,session_name:a.session_name,reference_example_id:a.reference_example_id,end_time:a.end_time,dotted_order:a.dotted_order,trace_id:a.trace_id,events:a.events,tags:a.tags,extra:a.extra,attachments:this.attachments,...s},{apiKey:t,apiUrl:r})}else try{const e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};await this.client.updateRun(this.id,e)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){const r=e?.callbacks;let s,a,i,o=nc();if(r){const u=r?.getParentRunId?.()??"",l=r?.handlers?.find(d=>d?.name=="langchain_tracer");s=l?.getRun?.(u),a=l?.projectName,i=l?.client,o=o||!!l}return s?new he({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:i,tracingEnabled:o,project_name:a,tags:[...new Set((s?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...s?.extra?.metadata,...e?.metadata}}}).createChild(t):new he({...t,client:i,tracingEnabled:o,project_name:a})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){const r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=r["langsmith-trace"];if(!s||typeof s!="string")return;const a=s.trim(),i=a.split(".").map(u=>{const[l,d]=u.split("Z");return{strTime:l,time:Date.parse(l+"Z"),uuid:d}}),o=i[0].uuid,c={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:i.at(-1)?.uuid,trace_id:o,dotted_order:a};if(r.baggage&&typeof r.baggage=="string"){const u=it.fromHeader(r.baggage);c.metadata=u.metadata,c.tags=u.tags,c.project_name=u.project_name,c.replicas=u.replicas}return new he(c)}toHeaders(e){const t={"langsmith-trace":this.dotted_order,baggage:new it(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(const[r,s]of Object.entries(t))e.set(r,s);return t}}Object.defineProperty(he,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function ic(n){return n!==void 0&&typeof n.createChild=="function"&&typeof n.postRun=="function"}function ra(n){return typeof n=="object"&&n!=null&&typeof n.name=="string"&&n.name==="langchain_tracer"}function Ns(n){return Array.isArray(n)&&n.some(e=>ra(e))}function oc(n){return typeof n=="object"&&n!=null&&Array.isArray(n.handlers)}function cc(n){return n!==void 0&&typeof n.callbacks=="object"&&(Ns(n.callbacks?.handlers)||Ns(n.callbacks))}function uc(n){return n.split(".").map(t=>{const r=t.slice(0,-36),s=t.slice(-36),a=parseInt(r.slice(0,4)),i=parseInt(r.slice(4,6))-1,o=parseInt(r.slice(6,8)),c=parseInt(r.slice(9,11)),u=parseInt(r.slice(11,13)),l=parseInt(r.slice(13,15)),d=parseInt(r.slice(15,21));return[new Date(a,i,o,c,u,l,d/1e3),s]})}function lc(){const n=_e("LANGSMITH_RUNS_ENDPOINTS");if(!n)return[];try{const e=JSON.parse(n);if(Array.isArray(e)){const t=[];for(const r of e){if(typeof r!="object"||r===null){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof r}`);continue}if(typeof r.api_url!="string"){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof r.api_url}`);continue}if(typeof r.api_key!="string"){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof r.api_key}`);continue}t.push({apiUrl:r.api_url.replace(/\/$/,""),apiKey:r.api_key})}return t}else if(typeof e=="object"&&e!==null){fc(e);const t=[];for(const[r,s]of Object.entries(e)){const a=r.replace(/\/$/,"");if(typeof s=="string")t.push({apiUrl:a,apiKey:s});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${r}: expected string, got ${typeof s}`);continue}}return t}else return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof e}`),[]}catch(e){if(Zo(e))throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}function dc(n){return n?n.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):lc()}function fc(n){if(Object.keys(n).length>0&&oe("ENDPOINT"))throw new Go}function mt(n,e,t){function r(o,c){var u;Object.defineProperty(o,"_zod",{value:o._zod??{},enumerable:!1}),(u=o._zod).traits??(u.traits=new Set),o._zod.traits.add(n),e(o,c);for(const l in i.prototype)l in o||Object.defineProperty(o,l,{value:i.prototype[l].bind(o)});o._zod.constr=i,o._zod.def=c}const s=t?.Parent??Object;class a extends s{}Object.defineProperty(a,"name",{value:n});function i(o){var c;const u=t?.Parent?new a:this;r(u,o),(c=u._zod).deferred??(c.deferred=[]);for(const l of u._zod.deferred)l();return u}return Object.defineProperty(i,"init",{value:r}),Object.defineProperty(i,Symbol.hasInstance,{value:o=>t?.Parent&&o instanceof t.Parent?!0:o?._zod?.traits?.has(n)}),Object.defineProperty(i,"name",{value:n}),i}class ot extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const hc={};function gt(n){return hc}function pc(n){const e=Object.values(n).filter(r=>typeof r=="number");return Object.entries(n).filter(([r,s])=>e.indexOf(+r)===-1).map(([r,s])=>s)}function mc(n,e){return typeof e=="bigint"?e.toString():e}const na=Error.captureStackTrace?Error.captureStackTrace:(...n)=>{};function Iu(n,e,t){const r=new n._zod.constr(e??n._zod.def);return(!e||t?.parent)&&(r._zod.parent=n),r}function gc(n){return{}}function Ir(n,e=0){for(let t=e;t<n.issues.length;t++)if(n.issues[t]?.continue!==!0)return!0;return!1}function Qe(n){return typeof n=="string"?n:n?.message}function _t(n,e,t){const r={...n,path:n.path??[]};if(!n.message){const s=Qe(n.inst?._zod.def?.error?.(n))??Qe(e?.error?.(n))??Qe(t.customError?.(n))??Qe(t.localeError?.(n))??"Invalid input";r.message=s}return delete r.inst,delete r.continue,e?.reportInput||delete r.input,r}const sa=(n,e)=>{n.name="$ZodError",Object.defineProperty(n,"_zod",{value:n._zod,enumerable:!1}),Object.defineProperty(n,"issues",{value:e,enumerable:!1}),Object.defineProperty(n,"message",{get(){return JSON.stringify(e,mc,2)},enumerable:!0}),Object.defineProperty(n,"toString",{value:()=>n.message,enumerable:!1})},_c=mt("$ZodError",sa),yt=mt("$ZodError",sa,{Parent:Error}),yc=n=>(e,t,r,s)=>{const a=r?Object.assign(r,{async:!1}):{async:!1},i=e._zod.run({value:t,issues:[]},a);if(i instanceof Promise)throw new ot;if(i.issues.length){const o=new(s?.Err??n)(i.issues.map(c=>_t(c,a,gt())));throw na(o,s?.callee),o}return i.value},ku=yc(yt),vc=n=>async(e,t,r,s)=>{const a=r?Object.assign(r,{async:!0}):{async:!0};let i=e._zod.run({value:t,issues:[]},a);if(i instanceof Promise&&(i=await i),i.issues.length){const o=new(s?.Err??n)(i.issues.map(c=>_t(c,a,gt())));throw na(o,s?.callee),o}return i.value},$u=vc(yt),bc=n=>(e,t,r)=>{const s=r?{...r,async:!1}:{async:!1},a=e._zod.run({value:t,issues:[]},s);if(a instanceof Promise)throw new ot;return a.issues.length?{success:!1,error:new(n??_c)(a.issues.map(i=>_t(i,s,gt())))}:{success:!0,data:a.value}},wc=bc(yt),Ec=n=>async(e,t,r)=>{const s=r?Object.assign(r,{async:!0}):{async:!0};let a=e._zod.run({value:t,issues:[]},s);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new n(a.issues.map(i=>_t(i,s,gt())))}:{success:!0,data:a.value}},Sc=Ec(yt),Tc={major:4,minor:0,patch:0},Oc=mt("$ZodType",(n,e)=>{var t;n??(n={}),n._zod.def=e,n._zod.bag=n._zod.bag||{},n._zod.version=Tc;const r=[...n._zod.def.checks??[]];n._zod.traits.has("$ZodCheck")&&r.unshift(n);for(const s of r)for(const a of s._zod.onattach)a(n);if(r.length===0)(t=n._zod).deferred??(t.deferred=[]),n._zod.deferred?.push(()=>{n._zod.run=n._zod.parse});else{const s=(a,i,o)=>{let c=Ir(a),u;for(const l of i){if(l._zod.def.when){if(!l._zod.def.when(a))continue}else if(c)continue;const d=a.issues.length,f=l._zod.check(a);if(f instanceof Promise&&o?.async===!1)throw new ot;if(u||f instanceof Promise)u=(u??Promise.resolve()).then(async()=>{await f,a.issues.length!==d&&(c||(c=Ir(a,d)))});else{if(a.issues.length===d)continue;c||(c=Ir(a,d))}}return u?u.then(()=>a):a};n._zod.run=(a,i)=>{const o=n._zod.parse(a,i);if(o instanceof Promise){if(i.async===!1)throw new ot;return o.then(c=>s(c,r,i))}return s(o,r,i)}}n["~standard"]={validate:s=>{try{const a=wc(n,s);return a.success?{value:a.data}:{issues:a.error?.issues}}catch{return Sc(n,s).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}}),Pu=mt("$ZodNever",(n,e)=>{Oc.init(n,e),n._zod.parse=(t,r)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:n}),t)});class aa{constructor(){this._map=new Map,this._idmap=new Map}add(e,...t){const r=t[0];if(this._map.set(e,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){const t=this._map.get(e);return t&&typeof t=="object"&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const r={...this.get(t)??{}};return delete r.id,{...r,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function xc(){return new aa}const Ac=xc();function Nu(n,e){return new n({type:"never",...gc()})}class Cs{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??Ac,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var r;const s=e._zod.def,a={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},i=this.seen.get(e);if(i)return i.count++,t.schemaPath.includes(e)&&(i.cycle=t.path),i.schema;const o={schema:{},count:1,cycle:void 0,path:t.path};this.seen.set(e,o);const c=e._zod.toJSONSchema?.();if(c)o.schema=c;else{const d={...t,schemaPath:[...t.schemaPath,e],path:t.path},f=e._zod.parent;if(f)o.ref=f,this.process(f,d),this.seen.get(f).isParent=!0;else{const p=o.schema;switch(s.type){case"string":{const h=p;h.type="string";const{minimum:m,maximum:g,format:_,patterns:b,contentEncoding:y}=e._zod.bag;if(typeof m=="number"&&(h.minLength=m),typeof g=="number"&&(h.maxLength=g),_&&(h.format=a[_]??_,h.format===""&&delete h.format),y&&(h.contentEncoding=y),b&&b.size>0){const N=[...b];N.length===1?h.pattern=N[0].source:N.length>1&&(o.schema.allOf=[...N.map(R=>({...this.target==="draft-7"?{type:"string"}:{},pattern:R.source}))])}break}case"number":{const h=p,{minimum:m,maximum:g,format:_,multipleOf:b,exclusiveMaximum:y,exclusiveMinimum:N}=e._zod.bag;typeof _=="string"&&_.includes("int")?h.type="integer":h.type="number",typeof N=="number"&&(h.exclusiveMinimum=N),typeof m=="number"&&(h.minimum=m,typeof N=="number"&&(N>=m?delete h.minimum:delete h.exclusiveMinimum)),typeof y=="number"&&(h.exclusiveMaximum=y),typeof g=="number"&&(h.maximum=g,typeof y=="number"&&(y<=g?delete h.maximum:delete h.exclusiveMaximum)),typeof b=="number"&&(h.multipleOf=b);break}case"boolean":{const h=p;h.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{p.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{p.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const h=p,{minimum:m,maximum:g}=e._zod.bag;typeof m=="number"&&(h.minItems=m),typeof g=="number"&&(h.maxItems=g),h.type="array",h.items=this.process(s.element,{...d,path:[...d.path,"items"]});break}case"object":{const h=p;h.type="object",h.properties={};const m=s.shape;for(const b in m)h.properties[b]=this.process(m[b],{...d,path:[...d.path,"properties",b]});const g=new Set(Object.keys(m)),_=new Set([...g].filter(b=>{const y=s.shape[b]._zod;return this.io==="input"?y.optin===void 0:y.optout===void 0}));_.size>0&&(h.required=Array.from(_)),s.catchall?._zod.def.type==="never"?h.additionalProperties=!1:s.catchall?s.catchall&&(h.additionalProperties=this.process(s.catchall,{...d,path:[...d.path,"additionalProperties"]})):this.io==="output"&&(h.additionalProperties=!1);break}case"union":{const h=p;h.anyOf=s.options.map((m,g)=>this.process(m,{...d,path:[...d.path,"anyOf",g]}));break}case"intersection":{const h=p,m=this.process(s.left,{...d,path:[...d.path,"allOf",0]}),g=this.process(s.right,{...d,path:[...d.path,"allOf",1]}),_=y=>"allOf"in y&&Object.keys(y).length===1,b=[..._(m)?m.allOf:[m],..._(g)?g.allOf:[g]];h.allOf=b;break}case"tuple":{const h=p;h.type="array";const m=s.items.map((b,y)=>this.process(b,{...d,path:[...d.path,"prefixItems",y]}));if(this.target==="draft-2020-12"?h.prefixItems=m:h.items=m,s.rest){const b=this.process(s.rest,{...d,path:[...d.path,"items"]});this.target==="draft-2020-12"?h.items=b:h.additionalItems=b}s.rest&&(h.items=this.process(s.rest,{...d,path:[...d.path,"items"]}));const{minimum:g,maximum:_}=e._zod.bag;typeof g=="number"&&(h.minItems=g),typeof _=="number"&&(h.maxItems=_);break}case"record":{const h=p;h.type="object",h.propertyNames=this.process(s.keyType,{...d,path:[...d.path,"propertyNames"]}),h.additionalProperties=this.process(s.valueType,{...d,path:[...d.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const h=p,m=pc(s.entries);m.every(g=>typeof g=="number")&&(h.type="number"),m.every(g=>typeof g=="string")&&(h.type="string"),h.enum=m;break}case"literal":{const h=p,m=[];for(const g of s.values)if(g===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof g=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");m.push(Number(g))}else m.push(g);if(m.length!==0)if(m.length===1){const g=m[0];h.type=g===null?"null":typeof g,h.const=g}else m.every(g=>typeof g=="number")&&(h.type="number"),m.every(g=>typeof g=="string")&&(h.type="string"),m.every(g=>typeof g=="boolean")&&(h.type="string"),m.every(g=>g===null)&&(h.type="null"),h.enum=m;break}case"file":{const h=p,m={type:"string",format:"binary",contentEncoding:"binary"},{minimum:g,maximum:_,mime:b}=e._zod.bag;g!==void 0&&(m.minLength=g),_!==void 0&&(m.maxLength=_),b?b.length===1?(m.contentMediaType=b[0],Object.assign(h,m)):h.anyOf=b.map(y=>({...m,contentMediaType:y})):Object.assign(h,m);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const h=this.process(s.innerType,d);p.anyOf=[h,{type:"null"}];break}case"nonoptional":{this.process(s.innerType,d),o.ref=s.innerType;break}case"success":{const h=p;h.type="boolean";break}case"default":{this.process(s.innerType,d),o.ref=s.innerType,p.default=JSON.parse(JSON.stringify(s.defaultValue));break}case"prefault":{this.process(s.innerType,d),o.ref=s.innerType,this.io==="input"&&(p._prefault=JSON.parse(JSON.stringify(s.defaultValue)));break}case"catch":{this.process(s.innerType,d),o.ref=s.innerType;let h;try{h=s.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}p.default=h;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const h=p,m=e._zod.pattern;if(!m)throw new Error("Pattern not found in template literal");h.type="string",h.pattern=m.source;break}case"pipe":{const h=this.io==="input"?s.in._zod.def.type==="transform"?s.out:s.in:s.out;this.process(h,d),o.ref=h;break}case"readonly":{this.process(s.innerType,d),o.ref=s.innerType,p.readOnly=!0;break}case"promise":{this.process(s.innerType,d),o.ref=s.innerType;break}case"optional":{this.process(s.innerType,d),o.ref=s.innerType;break}case"lazy":{const h=e._zod.innerType;this.process(h,d),o.ref=h;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}}}}const u=this.metadataRegistry.get(e);return u&&Object.assign(o.schema,u),this.io==="input"&&Q(e)&&(delete o.schema.examples,delete o.schema.default),this.io==="input"&&o.schema._prefault&&((r=o.schema).default??(r.default=o.schema._prefault)),delete o.schema._prefault,this.seen.get(e).schema}emit(e,t){const r={cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0},s=this.seen.get(e);if(!s)throw new Error("Unprocessed schema. This is a bug in Zod.");const a=l=>{const d=this.target==="draft-2020-12"?"$defs":"definitions";if(r.external){const m=r.external.registry.get(l[0])?.id,g=r.external.uri??(b=>b);if(m)return{ref:g(m)};const _=l[1].defId??l[1].schema.id??`schema${this.counter++}`;return l[1].defId=_,{defId:_,ref:`${g("__shared")}#/${d}/${_}`}}if(l[1]===s)return{ref:"#"};const p=`#/${d}/`,h=l[1].schema.id??`__schema${this.counter++}`;return{defId:h,ref:p+h}},i=l=>{if(l[1].schema.$ref)return;const d=l[1],{ref:f,defId:p}=a(l);d.def={...d.schema},p&&(d.defId=p);const h=d.schema;for(const m in h)delete h[m];h.$ref=f};if(r.cycles==="throw")for(const l of this.seen.entries()){const d=l[1];if(d.cycle)throw new Error(`Cycle detected: #/${d.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const l of this.seen.entries()){const d=l[1];if(e===l[0]){i(l);continue}if(r.external){const p=r.external.registry.get(l[0])?.id;if(e!==l[0]&&p){i(l);continue}}if(this.metadataRegistry.get(l[0])?.id){i(l);continue}if(d.cycle){i(l);continue}if(d.count>1&&r.reused==="ref"){i(l);continue}}const o=(l,d)=>{const f=this.seen.get(l),p=f.def??f.schema,h={...p};if(f.ref===null)return;const m=f.ref;if(f.ref=null,m){o(m,d);const g=this.seen.get(m).schema;g.$ref&&d.target==="draft-7"?(p.allOf=p.allOf??[],p.allOf.push(g)):(Object.assign(p,g),Object.assign(p,h))}f.isParent||this.override({zodSchema:l,jsonSchema:p,path:f.path??[]})};for(const l of[...this.seen.entries()].reverse())o(l[0],{target:this.target});const c={};if(this.target==="draft-2020-12"?c.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?c.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),r.external?.uri){const l=r.external.registry.get(e)?.id;if(!l)throw new Error("Schema is missing an `id` property");c.$id=r.external.uri(l)}Object.assign(c,s.def);const u=r.external?.defs??{};for(const l of this.seen.entries()){const d=l[1];d.def&&d.defId&&(u[d.defId]=d.def)}r.external||Object.keys(u).length>0&&(this.target==="draft-2020-12"?c.$defs=u:c.definitions=u);try{return JSON.parse(JSON.stringify(c))}catch{throw new Error("Error converting schema to JSON.")}}}function Cu(n,e){if(n instanceof aa){const r=new Cs(e),s={};for(const o of n._idmap.entries()){const[c,u]=o;r.process(u)}const a={},i={registry:n,uri:e?.uri,defs:s};for(const o of n._idmap.entries()){const[c,u]=o;a[c]=r.emit(u,{...e,external:i})}if(Object.keys(s).length>0){const o=r.target==="draft-2020-12"?"$defs":"definitions";a.__shared={[o]:s}}return{schemas:a}}const t=new Cs(e);return t.process(n),t.emit(n,e)}function Q(n,e){const t=e??{seen:new Set};if(t.seen.has(n))return!1;t.seen.add(n);const s=n._zod.def;switch(s.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return Q(s.element,t);case"object":{for(const a in s.shape)if(Q(s.shape[a],t))return!0;return!1}case"union":{for(const a of s.options)if(Q(a,t))return!0;return!1}case"intersection":return Q(s.left,t)||Q(s.right,t);case"tuple":{for(const a of s.items)if(Q(a,t))return!0;return!!(s.rest&&Q(s.rest,t))}case"record":return Q(s.keyType,t)||Q(s.valueType,t);case"map":return Q(s.keyType,t)||Q(s.valueType,t);case"set":return Q(s.valueType,t);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return Q(s.innerType,t);case"lazy":return Q(s.getter(),t);case"default":return Q(s.innerType,t);case"prefault":return Q(s.innerType,t);case"custom":return!1;case"transform":return!0;case"pipe":return Q(s.in,t)||Q(s.out,t);case"success":return!1;case"catch":return!1}throw new Error(`Unknown schema type: ${s.type}`)}const Rc=Symbol("Let zodToJsonSchema decide on which parser to use"),Ic={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},kc=n=>({...Ic,...n}),$c=n=>{const e=kc(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function ia(n,e,t,r){r?.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function J(n,e,t,r,s){n[e]=t,ia(n,e,r,s)}const oa=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")};function ue(n){if(n.target!=="openAi")return{};const e=[...n.basePath,n.definitionPath,n.openAiAnyTypeName];return n.flags.hasReferencedOpenAiAnyType=!0,{$ref:n.$refStrategy==="relative"?oa(e,n.currentPath):e.join("/")}}function Pc(n,e){const t={type:"array"};return n.type?._def&&n.type?._def?.typeName!==T.ZodAny&&(t.items=H(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&J(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&J(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(J(t,"minItems",n.exactLength.value,n.exactLength.message,e),J(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function Nc(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?J(t,"minimum",r.value,r.message,e):J(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),J(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?J(t,"maximum",r.value,r.message,e):J(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),J(t,"maximum",r.value,r.message,e));break;case"multipleOf":J(t,"multipleOf",r.value,r.message,e);break}return t}function Cc(){return{type:"boolean"}}function ca(n,e){return H(n.type._def,e)}const jc=(n,e)=>H(n.innerType._def,e);function ua(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,a)=>ua(n,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Lc(n,e)}}const Lc=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":J(t,"minimum",r.value,r.message,e);break;case"max":J(t,"maximum",r.value,r.message,e);break}return t};function Uc(n,e){return{...H(n.innerType._def,e),default:n.defaultValue()}}function Dc(n,e){return e.effectStrategy==="input"?H(n.schema._def,e):ue(e)}function Mc(n){return{type:"string",enum:Array.from(n.values)}}const qc=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function zc(n,e){const t=[H(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),H(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(a=>{if(qc(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...c}=a;i=c}else r=void 0;s.push(i)}}),s.length?{allOf:s,...r}:void 0}function Fc(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let kr;const de={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(kr===void 0&&(kr=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),kr),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function la(n,e){const t={type:"string"};if(n.checks)for(const r of n.checks)switch(r.kind){case"min":J(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":J(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":fe(t,"email",r.message,e);break;case"format:idn-email":fe(t,"idn-email",r.message,e);break;case"pattern:zod":ne(t,de.email,r.message,e);break}break;case"url":fe(t,"uri",r.message,e);break;case"uuid":fe(t,"uuid",r.message,e);break;case"regex":ne(t,r.regex,r.message,e);break;case"cuid":ne(t,de.cuid,r.message,e);break;case"cuid2":ne(t,de.cuid2,r.message,e);break;case"startsWith":ne(t,RegExp(`^${$r(r.value,e)}`),r.message,e);break;case"endsWith":ne(t,RegExp(`${$r(r.value,e)}$`),r.message,e);break;case"datetime":fe(t,"date-time",r.message,e);break;case"date":fe(t,"date",r.message,e);break;case"time":fe(t,"time",r.message,e);break;case"duration":fe(t,"duration",r.message,e);break;case"length":J(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),J(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{ne(t,RegExp($r(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&fe(t,"ipv4",r.message,e),r.version!=="v4"&&fe(t,"ipv6",r.message,e);break}case"base64url":ne(t,de.base64url,r.message,e);break;case"jwt":ne(t,de.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&ne(t,de.ipv4Cidr,r.message,e),r.version!=="v4"&&ne(t,de.ipv6Cidr,r.message,e);break}case"emoji":ne(t,de.emoji(),r.message,e);break;case"ulid":{ne(t,de.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{fe(t,"binary",r.message,e);break}case"contentEncoding:base64":{J(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{ne(t,de.base64,r.message,e);break}}break}case"nanoid":ne(t,de.nanoid,r.message,e)}return t}function $r(n,e){return e.patternStrategy==="escape"?Zc(n):n}const Gc=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Zc(n){let e="";for(let t=0;t<n.length;t++)Gc.has(n[t])||(e+="\\"),e+=n[t];return e}function fe(n,e,t,r){n.format||n.anyOf?.some(s=>s.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):J(n,"format",e,t,r)}function ne(n,e,t,r){n.pattern||n.allOf?.some(s=>s.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:js(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):J(n,"pattern",js(e,r),t,r)}function js(n,e){if(!e.applyRegexFlags||!n.flags)return n.source;const t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source;let s="",a=!1,i=!1,o=!1;for(let c=0;c<r.length;c++){if(a){s+=r[c],a=!1;continue}if(t.i){if(i){if(r[c].match(/[a-z]/)){o?(s+=r[c],s+=`${r[c-2]}-${r[c]}`.toUpperCase(),o=!1):r[c+1]==="-"&&r[c+2]?.match(/[a-z]/)?(s+=r[c],o=!0):s+=`${r[c]}${r[c].toUpperCase()}`;continue}}else if(r[c].match(/[a-z]/)){s+=`[${r[c]}${r[c].toUpperCase()}]`;continue}}if(t.m){if(r[c]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[c]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&r[c]==="."){s+=i?`${r[c]}\r
`:`[${r[c]}\r
]`;continue}s+=r[c],r[c]==="\\"?a=!0:i&&r[c]==="]"?i=!1:!i&&r[c]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return s}function da(n,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&n.keyType?._def.typeName===T.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((r,s)=>({...r,[s]:H(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",s]})??ue(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:H(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(n.keyType?._def.typeName===T.ZodString&&n.keyType._def.checks?.length){const{type:r,...s}=la(n.keyType._def,e);return{...t,propertyNames:s}}else{if(n.keyType?._def.typeName===T.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};if(n.keyType?._def.typeName===T.ZodBranded&&n.keyType._def.type._def.typeName===T.ZodString&&n.keyType._def.type._def.checks?.length){const{type:r,...s}=ca(n.keyType._def,e);return{...t,propertyNames:s}}}return t}function Bc(n,e){if(e.mapStrategy==="record")return da(n,e);const t=H(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||ue(e),r=H(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||ue(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function Hc(n){const e=n.values,r=Object.keys(n.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(r.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function Vc(n){return n.target==="openAi"?void 0:{not:ue({...n,currentPath:[...n.currentPath,"not"]})}}function Jc(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const ct={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Kc(n,e){if(e.target==="openApi3")return Ls(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in ct&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((s,a)=>{const i=ct[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===t.length){const s=r.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:t.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,s)=>[...r,...s._def.values.filter(a=>!r.includes(a))],[])};return Ls(n,e)}const Ls=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,s)=>H(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function Wc(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:ct[n.innerType._def.typeName],nullable:!0}:{type:[ct[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=H(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=H(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function Xc(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",ia(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?J(t,"minimum",r.value,r.message,e):J(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),J(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?J(t,"maximum",r.value,r.message,e):J(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),J(t,"maximum",r.value,r.message,e));break;case"multipleOf":J(t,"multipleOf",r.value,r.message,e);break}return t}function Qc(n,e){const t=e.target==="openAi",r={type:"object",properties:{}},s=[],a=n.shape();for(const o in a){let c=a[o];if(c===void 0||c._def===void 0)continue;let u=eu(c);u&&t&&(c._def.typeName==="ZodOptional"&&(c=c._def.innerType),c.isNullable()||(c=c.nullable()),u=!1);const l=H(c._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});l!==void 0&&(r.properties[o]=l,u||s.push(o))}s.length&&(r.required=s);const i=Yc(n,e);return i!==void 0&&(r.additionalProperties=i),r}function Yc(n,e){if(n.catchall._def.typeName!=="ZodNever")return H(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(n.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function eu(n){try{return n.isOptional()}catch{return!0}}const tu=(n,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return H(n.innerType._def,e);const t=H(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:ue(e)},t]}:ue(e)},ru=(n,e)=>{if(e.pipeStrategy==="input")return H(n.in._def,e);if(e.pipeStrategy==="output")return H(n.out._def,e);const t=H(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=H(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(s=>s!==void 0)}};function nu(n,e){return H(n.type._def,e)}function su(n,e){const r={type:"array",uniqueItems:!0,items:H(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&J(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&J(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function au(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>H(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:H(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>H(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function iu(n){return{not:ue(n)}}function ou(n){return ue(n)}const cu=(n,e)=>H(n.innerType._def,e),uu=(n,e,t)=>{switch(e){case T.ZodString:return la(n,t);case T.ZodNumber:return Xc(n,t);case T.ZodObject:return Qc(n,t);case T.ZodBigInt:return Nc(n,t);case T.ZodBoolean:return Cc();case T.ZodDate:return ua(n,t);case T.ZodUndefined:return iu(t);case T.ZodNull:return Jc(t);case T.ZodArray:return Pc(n,t);case T.ZodUnion:case T.ZodDiscriminatedUnion:return Kc(n,t);case T.ZodIntersection:return zc(n,t);case T.ZodTuple:return au(n,t);case T.ZodRecord:return da(n,t);case T.ZodLiteral:return Fc(n,t);case T.ZodEnum:return Mc(n);case T.ZodNativeEnum:return Hc(n);case T.ZodNullable:return Wc(n,t);case T.ZodOptional:return tu(n,t);case T.ZodMap:return Bc(n,t);case T.ZodSet:return su(n,t);case T.ZodLazy:return()=>n.getter()._def;case T.ZodPromise:return nu(n,t);case T.ZodNaN:case T.ZodNever:return Vc(t);case T.ZodEffects:return Dc(n,t);case T.ZodAny:return ue(t);case T.ZodUnknown:return ou(t);case T.ZodDefault:return Uc(n,t);case T.ZodBranded:return ca(n,t);case T.ZodReadonly:return cu(n,t);case T.ZodCatch:return jc(n,t);case T.ZodPipeline:return ru(n,t);case T.ZodFunction:case T.ZodVoid:case T.ZodSymbol:return;default:return(r=>{})()}};function H(n,e,t=!1){const r=e.seen.get(n);if(e.override){const o=e.override?.(n,e,r,t);if(o!==Rc)return o}if(r&&!t){const o=lu(r,e);if(o!==void 0)return o}const s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);const a=uu(n,n.typeName,e),i=typeof a=="function"?H(a(),e):a;if(i&&du(n,e,i),e.postProcess){const o=e.postProcess(i,n,e);return s.jsonSchema=i,o}return s.jsonSchema=i,i}const lu=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:oa(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),ue(e)):e.$refStrategy==="seen"?ue(e):void 0}},du=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),ju=(n,e)=>{const t=$c(e);let r;const s=e?.name,a=H(n._def,t,!1)??ue(t);t.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[t.openAiAnyTypeName]||(r[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));const i=s===void 0?r?{...a,[t.definitionPath]:r}:a:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...r,[s]:a}};return t.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};function Us(n,e){const t=typeof n;if(t!==typeof e)return!1;if(Array.isArray(n)){if(!Array.isArray(e))return!1;const r=n.length;if(r!==e.length)return!1;for(let s=0;s<r;s++)if(!Us(n[s],e[s]))return!1;return!0}if(t==="object"){if(!n||!e)return n===e;const r=Object.keys(n),s=Object.keys(e);if(r.length!==s.length)return!1;for(const i of r)if(!Us(n[i],e[i]))return!1;return!0}return n===e}var Me={},Ds;function fu(){if(Ds)return Me;Ds=1,Me.byteLength=o,Me.toByteArray=u,Me.fromByteArray=f;for(var n=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=r.length;s<a;++s)n[s]=r[s],e[r.charCodeAt(s)]=s;e[45]=62,e[95]=63;function i(p){var h=p.length;if(h%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var m=p.indexOf("=");m===-1&&(m=h);var g=m===h?0:4-m%4;return[m,g]}function o(p){var h=i(p),m=h[0],g=h[1];return(m+g)*3/4-g}function c(p,h,m){return(h+m)*3/4-m}function u(p){var h,m=i(p),g=m[0],_=m[1],b=new t(c(p,g,_)),y=0,N=_>0?g-4:g,R;for(R=0;R<N;R+=4)h=e[p.charCodeAt(R)]<<18|e[p.charCodeAt(R+1)]<<12|e[p.charCodeAt(R+2)]<<6|e[p.charCodeAt(R+3)],b[y++]=h>>16&255,b[y++]=h>>8&255,b[y++]=h&255;return _===2&&(h=e[p.charCodeAt(R)]<<2|e[p.charCodeAt(R+1)]>>4,b[y++]=h&255),_===1&&(h=e[p.charCodeAt(R)]<<10|e[p.charCodeAt(R+1)]<<4|e[p.charCodeAt(R+2)]>>2,b[y++]=h>>8&255,b[y++]=h&255),b}function l(p){return n[p>>18&63]+n[p>>12&63]+n[p>>6&63]+n[p&63]}function d(p,h,m){for(var g,_=[],b=h;b<m;b+=3)g=(p[b]<<16&16711680)+(p[b+1]<<8&65280)+(p[b+2]&255),_.push(l(g));return _.join("")}function f(p){for(var h,m=p.length,g=m%3,_=[],b=16383,y=0,N=m-g;y<N;y+=b)_.push(d(p,y,y+b>N?N:y+b));return g===1?(h=p[m-1],_.push(n[h>>2]+n[h<<4&63]+"==")):g===2&&(h=(p[m-2]<<8)+p[m-1],_.push(n[h>>10]+n[h>>4&63]+n[h<<2&63]+"=")),_.join("")}return Me}var hu=fu();const pu=ut(hu);var mu=Object.defineProperty,gu=(n,e,t)=>e in n?mu(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,_u=(n,e,t)=>(gu(n,e+"",t),t);function yu(n,e){let t=Array.from({length:n.length},(r,s)=>({start:s,end:s+1}));for(;t.length>1;){let r=null;for(let s=0;s<t.length-1;s++){const a=n.slice(t[s].start,t[s+1].end),i=e.get(a.join(","));i!=null&&(r==null||i<r[0])&&(r=[i,s])}if(r!=null){const s=r[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function vu(n,e){return n.length===1?[e.get(n.join(","))]:yu(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function bu(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var qr=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(n,e){this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{const[a,i,...o]=s.split(" "),c=Number.parseInt(i,10);return o.forEach((u,l)=>r[u]=c+l),r},{});for(const[r,s]of Object.entries(t)){const a=pu.toByteArray(r);this.rankMap.set(a.join(","),s),this.textMap.set(s,a)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,a])=>(r[a]=this.textEncoder.encode(s),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),s=qr.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(u=>!i.has(u)):t);if(o.size>0){const u=qr.specialTokenRegex([...o]),l=n.match(u);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let c=0;for(;;){let u=null,l=c;for(;s.lastIndex=l,u=s.exec(n),!(u==null||i.has(u[0]));)l=u.index+1;const d=u?.index??n.length;for(const p of n.substring(c,d).matchAll(r)){const h=this.textEncoder.encode(p[0]),m=this.rankMap.get(h.join(","));if(m!=null){a.push(m);continue}a.push(...vu(h,this.rankMap))}if(u==null)break;let f=this.specialTokens[u[0]];a.push(f),c=u.index+u[0].length}return a}decode(n){const e=[];let t=0;for(let a=0;a<n.length;++a){const i=n[a],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let s=0;for(const a of e)r.set(a,s),s+=a.length;return this.textDecoder.decode(r)}},wu=qr;_u(wu,"specialTokenRegex",n=>new RegExp(n.map(e=>bu(e)).join("|"),"g"));function Lu(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}export{Pu as $,at as C,jt as P,he as R,wu as T,Nu as _,qi as a,Au as b,ac as c,Ac as d,$u as e,Iu as f,ut as g,ku as h,Ka as i,Ru as j,Ou as k,Tu as l,Lu as m,Us as n,xu as o,Va as p,Eu as r,Su as s,Cu as t,Ie as v,ju as z};
